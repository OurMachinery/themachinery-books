<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Write a custom component - The Machinery Book</title>
        <!-- Custom HTML head -->
<meta name="twitter:card" content="summary_large_image" />

<meta name="twitter:image" content="https://ourmachinery.com/images/machinery-logo.png" />
<meta name="twitter:title" content="Our Machinery">
<meta name="twitter:description" content="Our Machinery" />

<meta name="twitter:site" content="@ourmachinery" />


<meta property="og:title" content="Tutorials &middot; Our Machinery" />
<meta property="og:site_name" content="Our Machinery" />
<meta property="og:url" content="https://ourmachinery.com/tutorials/" />

<meta property="og:image" content="https://ourmachinery.com/images/machinery-logo.png" />


<meta property="og:type" content="website" />
<meta property="og:description" content="Our Machinery" />        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item "><a href="../../index.html"><strong aria-hidden="true">1.</strong> Welcome</a></li><li class="chapter-item "><a href="../../what_is_the_machinery.html"><strong aria-hidden="true">2.</strong> What is The Machinery</a></li><li class="chapter-item "><a href="../../licenses.html"><strong aria-hidden="true">3.</strong> Licenses</a></li><li class="chapter-item "><a href="../../faq.html"><strong aria-hidden="true">4.</strong> FAQ</a></li><li class="chapter-item "><a href="../../glossary.html"><strong aria-hidden="true">5.</strong> Glossary</a></li><li class="chapter-item "><a href="../../troubleshooting.html"><strong aria-hidden="true">6.</strong> Troubleshooting</a></li><li class="chapter-item "><a href="../../contributing.html"><strong aria-hidden="true">7.</strong> Contribution</a></li><li class="chapter-item "><a href="../../getting_started/index.html"><strong aria-hidden="true">8.</strong> Getting Started</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../getting_started/what_is_in_the_package.html"><strong aria-hidden="true">8.1.</strong> What is in this package</a></li><li class="chapter-item "><a href="../../getting_started/logging_in.html"><strong aria-hidden="true">8.2.</strong> Sign In</a></li><li class="chapter-item "><a href="../../getting_started/project_setup.html"><strong aria-hidden="true">8.3.</strong> Project Setup</a></li><li class="chapter-item "><a href="../../getting_started/version_control.html"><strong aria-hidden="true">8.4.</strong> Version Control</a></li><li class="chapter-item "><a href="../../getting_started/new_project.html"><strong aria-hidden="true">8.5.</strong> New Project</a></li><li class="chapter-item "><a href="../../getting_started/first_gameplay_project.html"><strong aria-hidden="true">8.6.</strong> First Gameplay Project</a></li><li class="chapter-item "><a href="../../getting_started/sample-projects.html"><strong aria-hidden="true">8.7.</strong> Sample Projects</a></li><li class="chapter-item "><a href="../../getting_started/migration_from_unity.html"><strong aria-hidden="true">8.8.</strong> The Machinery for Unity Dev's</a></li><li class="chapter-item "><a href="../../getting_started/migration_from_unreal.html"><strong aria-hidden="true">8.9.</strong> The Machinery for Unreal 4 Dev's</a></li><li class="chapter-item "><a href="../../getting_started/migration_from_godot.html"><strong aria-hidden="true">8.10.</strong> The Machinery for Godot Dev's</a></li><li class="chapter-item "><a href="../../getting_started/introduction_to_c.html"><strong aria-hidden="true">8.11.</strong> Introduction to C</a></li></ol></li><li class="chapter-item "><a href="../../the_editor/index.html"><strong aria-hidden="true">9.</strong> The Editor</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../the_editor/tabs.html"><strong aria-hidden="true">9.1.</strong> About Tabs</a></li><li class="chapter-item "><a href="../../the_editor/entity_tree_tab.html"><strong aria-hidden="true">9.2.</strong> Entity Tree Tab</a></li><li class="chapter-item "><a href="../../the_editor/scene_tab.html"><strong aria-hidden="true">9.3.</strong> Scene Tab</a></li><li class="chapter-item "><a href="../../the_editor/properties_tab.html"><strong aria-hidden="true">9.4.</strong> Properties Tab</a></li><li class="chapter-item "><a href="../../the_editor/asset_browser.html"><strong aria-hidden="true">9.5.</strong> Asset Browser</a></li><li class="chapter-item "><a href="../../the_editor/simulate_tab.html"><strong aria-hidden="true">9.6.</strong> Simulate Tab</a></li><li class="chapter-item "><a href="../../the_editor/preview_tab.html"><strong aria-hidden="true">9.7.</strong> Preview Tab</a></li><li class="chapter-item "><a href="../../the_editor/customizations.html"><strong aria-hidden="true">9.8.</strong> Customizations</a></li></ol></li><li class="chapter-item "><a href="../../editing_workflows/index.html"><strong aria-hidden="true">10.</strong> Editing Workflows</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../editing_workflows/entities.html"><strong aria-hidden="true">10.1.</strong> Entities</a></li><li class="chapter-item "><a href="../../editing_workflows/import_assets.html"><strong aria-hidden="true">10.2.</strong> Import Assets</a></li><li class="chapter-item "><a href="../../editing_workflows/import_projects.html"><strong aria-hidden="true">10.3.</strong> Import Projects</a></li><li class="chapter-item "><a href="../../editing_workflows/asset_pipeline.html"><strong aria-hidden="true">10.4.</strong> Asset pipeline by Example</a></li><li class="chapter-item "><a href="../../editing_workflows/prototype_workflow/index.html"><strong aria-hidden="true">10.5.</strong> Prototypes</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../editing_workflows/prototype_workflow/how_to_create_prototypes.html"><strong aria-hidden="true">10.5.1.</strong> How to Create Prototypes</a></li><li class="chapter-item "><a href="../../editing_workflows/prototype_workflow/how_to_instantiate_prototypes.html"><strong aria-hidden="true">10.5.2.</strong> How to Instantiate Prototypes</a></li></ol></li><li class="chapter-item "><a href="../../editing_workflows/shaders_materials.html"><strong aria-hidden="true">10.6.</strong> Meshes / Materials / Shaders</a></li><li class="chapter-item "><a href="../../editing_workflows/simulation.html"><strong aria-hidden="true">10.7.</strong> Simulation</a></li><li class="chapter-item "><a href="../../editing_workflows/visual-scripting.html"><strong aria-hidden="true">10.8.</strong> Visual Scripting: Entity Graphs</a></li><li class="chapter-item "><a href="../../editing_workflows/physics.html"><strong aria-hidden="true">10.9.</strong> Physics</a></li><li class="chapter-item "><a href="../../editing_workflows/animation/index.html"><strong aria-hidden="true">10.10.</strong> Animation</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../editing_workflows/animation/animation-state-machine.html"><strong aria-hidden="true">10.10.1.</strong> Animation State Machines</a></li><li class="chapter-item "><a href="../../editing_workflows/animation/animation-compression.html"><strong aria-hidden="true">10.10.2.</strong> Animation Compression</a></li></ol></li><li class="chapter-item "><a href="../../editing_workflows/sound.html"><strong aria-hidden="true">10.11.</strong> Sound</a></li><li class="chapter-item "><a href="../../editing_workflows/publish.html"><strong aria-hidden="true">10.12.</strong> Publish</a></li><li class="chapter-item "><a href="../../editing_workflows/sculpting.html"><strong aria-hidden="true">10.13.</strong> Sculpt Tool / White boxing</a></li></ol></li><li class="chapter-item "><a href="../../the_truth/index.html"><strong aria-hidden="true">11.</strong> The Truth</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../the_truth/access_values.html"><strong aria-hidden="true">11.1.</strong> Access values</a></li><li class="chapter-item "><a href="../../the_truth/create_an_object.html"><strong aria-hidden="true">11.2.</strong> Create an object</a></li><li class="chapter-item "><a href="../../the_truth/modify_an_object.html"><strong aria-hidden="true">11.3.</strong> Modify an object</a></li><li class="chapter-item "><a href="../../the_truth/common_types.html"><strong aria-hidden="true">11.4.</strong> Common Types</a></li><li class="chapter-item "><a href="../../the_truth/aspects.html"><strong aria-hidden="true">11.5.</strong> Aspects</a></li><li class="chapter-item "><a href="../../the_truth/custom_truth_type.html"><strong aria-hidden="true">11.6.</strong> Create a Truth Type</a></li></ol></li><li class="chapter-item "><a href="../../creation_graphs/concept.html"><strong aria-hidden="true">12.</strong> Creation Graphs</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../creation_graphs/intro_unity.html"><strong aria-hidden="true">12.1.</strong> Creation Graphs for Untiy Dev's</a></li><li class="chapter-item "><a href="../../creation_graphs/intro_unreal.html"><strong aria-hidden="true">12.2.</strong> Creation Graphs for Unreal 4 Dev's</a></li><li class="chapter-item "><a href="../../creation_graphs/node_types.html"><strong aria-hidden="true">12.3.</strong> Node Types</a></li><li class="chapter-item "><a href="../../creation_graphs/shader_system.html"><strong aria-hidden="true">12.4.</strong> Shader System Interaction</a></li></ol></li><li class="chapter-item "><a href="../../graphics/index.html"><strong aria-hidden="true">13.</strong> Graphics</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../graphics/camera/index.html"><strong aria-hidden="true">13.1.</strong> Camera</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../graphics/camera/physical_light_and_camera.html"><strong aria-hidden="true">13.1.1.</strong> Physically Based Light and Cameras</a></li></ol></li><li class="chapter-item "><a href="../../graphics/default_render_pipeline.html"><strong aria-hidden="true">13.2.</strong> Default Render Pipeline</a></li><li class="chapter-item "><a href="../../graphics/mesh_materials.html"><strong aria-hidden="true">13.3.</strong> Meshes / Materials</a></li><li class="chapter-item "><a href="../../graphics/shaders.html"><strong aria-hidden="true">13.4.</strong> Shaders</a></li><li class="chapter-item "><a href="../../graphics/the_machinery_shading_language.html"><strong aria-hidden="true">13.5.</strong> The Machinery Shading Language</a></li><li class="chapter-item "><a href="../../graphics/tmsl_vs.html"><strong aria-hidden="true">13.6.</strong> .tmsl Visual Studio Extension</a></li><li class="chapter-item "><a href="../../graphics/post_processing/index.html"><strong aria-hidden="true">13.7.</strong> Post Processing</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../graphics/post_processing/aa.html"><strong aria-hidden="true">13.7.1.</strong> Anti-Aliasing</a></li><li class="chapter-item "><a href="../../graphics/post_processing/exposure.html"><strong aria-hidden="true">13.7.2.</strong> Exposure</a></li><li class="chapter-item "><a href="../../graphics/post_processing/bloom.html"><strong aria-hidden="true">13.7.3.</strong> Bloom</a></li><li class="chapter-item "><a href="../../graphics/post_processing/color_grading.html"><strong aria-hidden="true">13.7.4.</strong> Color Grading</a></li></ol></li></ol></li><li class="chapter-item "><a href="../../extending_the_machinery/index.html"><strong aria-hidden="true">14.</strong> Extending The Machinery</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../extending_the_machinery/the_plugin_system.html"><strong aria-hidden="true">14.1.</strong> The Plugin System</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../extending_the_machinery/write-a-plugin.html"><strong aria-hidden="true">14.1.1.</strong> Write a plugin</a></li><li class="chapter-item "><a href="../../extending_the_machinery/sample_plugin.html"><strong aria-hidden="true">14.1.2.</strong> Sample Plugins</a></li><li class="chapter-item "><a href="../../extending_the_machinery/write-a-tab.html"><strong aria-hidden="true">14.1.3.</strong> Write a tab</a></li><li class="chapter-item "><a href="../../extending_the_machinery/plugin-assets.html"><strong aria-hidden="true">14.1.4.</strong> Plugin assets</a></li></ol></li><li class="chapter-item "><a href="../../extending_the_machinery/hot-reloading.html"><strong aria-hidden="true">14.2.</strong> Hot-reloading</a></li><li class="chapter-item "><a href="../../extending_the_machinery/application_hooks.html"><strong aria-hidden="true">14.3.</strong> Application Hooks</a></li><li class="chapter-item "><a href="../../build_tools/premake.html"><strong aria-hidden="true">14.4.</strong> Premake</a></li><li class="chapter-item "><a href="../../build_tools/tmbuild.html"><strong aria-hidden="true">14.5.</strong> tmbuild</a></li></ol></li><li class="chapter-item expanded "><a href="../../gameplay_coding/index.html"><strong aria-hidden="true">15.</strong> Gameplay coding</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../gameplay_coding/simulation_entry.html"><strong aria-hidden="true">15.1.</strong> Simulation Entry in C</a></li><li class="chapter-item "><a href="../../gameplay_coding/visual_scripting/index.html"><strong aria-hidden="true">15.2.</strong> Visual Scripting</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../gameplay_coding/visual_scripting/subgraphs.html"><strong aria-hidden="true">15.2.1.</strong> Subgraphs</a></li><li class="chapter-item "><a href="../../gameplay_coding/visual_scripting/debugger.html"><strong aria-hidden="true">15.2.2.</strong> Debugger</a></li><li class="chapter-item "><a href="../../gameplay_coding/visual_scripting/extend_the_entity_graph.html"><strong aria-hidden="true">15.2.3.</strong> Extending the Entity Graph</a></li><li class="chapter-item "><a href="../../gameplay_coding/visual_scripting/provide_custom_data_type_to_the_entity_graph.html"><strong aria-hidden="true">15.2.4.</strong> Custom Data Type for the Entity Graph</a></li></ol></li><li class="chapter-item expanded "><a href="../../gameplay_coding/ecs/index.html"><strong aria-hidden="true">15.3.</strong> Entity Component System</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../gameplay_coding/ecs/what_are_components.html"><strong aria-hidden="true">15.3.1.</strong> What are components</a></li><li class="chapter-item "><a href="../../gameplay_coding/ecs/how_entites_can_interact.html"><strong aria-hidden="true">15.3.2.</strong> How can Entities Interact?</a></li><li class="chapter-item "><a href="../../gameplay_coding/ecs/how_to_design_system_or_engine.html"><strong aria-hidden="true">15.3.3.</strong> How to design a System or an Engine?</a></li><li class="chapter-item "><a href="../../gameplay_coding/ecs/how_to_define_a_engine_system.html"><strong aria-hidden="true">15.3.4.</strong> How to define a System or an Engine?</a></li><li class="chapter-item "><a href="../../gameplay_coding/ecs/how_to_register_a_system_or_engine.html"><strong aria-hidden="true">15.3.5.</strong> How to register a System or an Engine?</a></li><li class="chapter-item expanded "><a href="../../gameplay_coding/ecs/write_a_custom_component.html" class="active"><strong aria-hidden="true">15.3.6.</strong> Write a custom component</a></li><li class="chapter-item "><a href="../../gameplay_coding/ecs/tagging_entities.html"><strong aria-hidden="true">15.3.7.</strong> Tagging Entities</a></li><li class="chapter-item "><a href="../../gameplay_coding/ecs/filtering_entities.html"><strong aria-hidden="true">15.3.8.</strong> Filtering Entities</a></li><li class="chapter-item "><a href="../../gameplay_coding/ecs/simulation_lifecycle.html"><strong aria-hidden="true">15.3.9.</strong> Simulation Lifecycle</a></li></ol></li><li class="chapter-item "><a href="../../gameplay_coding/gameplay_entry_comparison.html"><strong aria-hidden="true">15.4.</strong> Gameplay Entry Point Comparison</a></li></ol></li><li class="chapter-item "><a href="../../tutorials/index.html"><strong aria-hidden="true">16.</strong> Tutorials</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../tutorials/creation_graph/index.html"><strong aria-hidden="true">16.1.</strong> Creation Graph</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../tutorials/creation_graph/introduction_walkthrough/index.html"><strong aria-hidden="true">16.1.1.</strong> Creation Graph Introduction Series</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../tutorials/creation_graph/introduction_walkthrough/texture_compression.html"><strong aria-hidden="true">16.1.1.1.</strong> Simple Texture Compression</a></li><li class="chapter-item "><a href="../../tutorials/creation_graph/introduction_walkthrough/creation_graph_prototype.html"><strong aria-hidden="true">16.1.1.2.</strong> Creation Graph Prototype</a></li><li class="chapter-item "><a href="../../tutorials/creation_graph/introduction_walkthrough/custom_import_settings.html"><strong aria-hidden="true">16.1.1.3.</strong> Custom Import Settings</a></li></ol></li><li class="chapter-item "><a href="../../tutorials/creation_graph/custom_gpu_nodes.html"><strong aria-hidden="true">16.1.2.</strong> Creating Custom GPU Nodes</a></li><li class="chapter-item "><a href="../../tutorials/creation_graph/custom_cpu_nodes.html"><strong aria-hidden="true">16.1.3.</strong> Creating Custom CPU Nodes</a></li><li class="chapter-item "><a href="../../tutorials/creation_graph/custom_geometry_node.html"><strong aria-hidden="true">16.1.4.</strong> Creating Custom Geometry Nodes</a></li><li class="chapter-item "><a href="../../tutorials/creation_graph/from_code.html"><strong aria-hidden="true">16.1.5.</strong> Calling Creation Graphs from Code</a></li><li class="chapter-item "><a href="../../tutorials/creation_graph/raymarch_output_node.html"><strong aria-hidden="true">16.1.6.</strong> Creating a Custom Raymarching Output Node</a></li></ol></li><li class="chapter-item "><a href="../../tutorials/physics/index.html"><strong aria-hidden="true">16.2.</strong> Physics</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../tutorials/physics/triggers.html"><strong aria-hidden="true">16.2.1.</strong> Triggers</a></li></ol></li><li class="chapter-item "><a href="../../tutorials/the_truth/index.html"><strong aria-hidden="true">16.3.</strong> The Truth</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../tutorials/the_truth/custom_asset/index.html"><strong aria-hidden="true">16.3.1.</strong> Creating a Custom Asset Type</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../tutorials/the_truth/custom_asset/part1.html"><strong aria-hidden="true">16.3.1.1.</strong> Part 1 - Create an Asset Truth Type, Addable via Asset Browser</a></li><li class="chapter-item "><a href="../../tutorials/the_truth/custom_asset/part2.html"><strong aria-hidden="true">16.3.1.2.</strong> Part 2 - Custom UI</a></li><li class="chapter-item "><a href="../../tutorials/the_truth/custom_asset/part3.html"><strong aria-hidden="true">16.3.1.3.</strong> Part 3 - Custom Importer</a></li></ol></li><li class="chapter-item "><a href="../../tutorials/the_truth/drag_and_drop.html"><strong aria-hidden="true">16.3.2.</strong> Adding Drag and Drop to Assets</a></li><li class="chapter-item "><a href="../../tutorials/the_truth/open_asset.html"><strong aria-hidden="true">16.3.3.</strong> Open Asset in Tab</a></li></ol></li><li class="chapter-item "><a href="../../tutorials/network/index.html"><strong aria-hidden="true">16.4.</strong> Network</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../tutorials/network/animation_sample/network_assets.html"><strong aria-hidden="true">16.4.1.</strong> Part 1: Network Asset</a></li><li class="chapter-item "><a href="../../tutorials/network/animation_sample/multiple_network_instances.html"><strong aria-hidden="true">16.4.2.</strong> Part 2: Multiple Instances</a></li><li class="chapter-item "><a href="../../tutorials/network/animation_sample/entity_control.html"><strong aria-hidden="true">16.4.3.</strong> Part 3: Entity Control</a></li><li class="chapter-item "><a href="../../tutorials/network/animation_sample/support_multiple_players.html"><strong aria-hidden="true">16.4.4.</strong> Part 4: Multiple Players</a></li><li class="chapter-item "><a href="../../tutorials/network/animation_sample/basic_graph_variables.html"><strong aria-hidden="true">16.4.5.</strong> Part 5: Variable Replication (Graph)</a></li><li class="chapter-item "><a href="../../tutorials/network/animation_sample/smooth_animation.html"><strong aria-hidden="true">16.4.6.</strong> Part 6: Smooth Animation</a></li><li class="chapter-item "><a href="../../tutorials/network/animation_sample/spawning_entities.html"><strong aria-hidden="true">16.4.7.</strong> Part 7: Spawning Entities</a></li></ol></li><li class="chapter-item "><a href="../../tutorials/ui/index.html"><strong aria-hidden="true">16.5.</strong> UI</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../tutorials/ui/build_custom_ui_controls/index.html"><strong aria-hidden="true">16.5.1.</strong> Build Custom UI Controls</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../tutorials/ui/build_custom_ui_controls/part1.html"><strong aria-hidden="true">16.5.1.1.</strong> Part 1</a></li></ol></li><li class="chapter-item "><a href="../../tutorials/ui/toolbars-overlays.html"><strong aria-hidden="true">16.5.2.</strong> Toolbars and Overlays</a></li><li class="chapter-item "><a href="../../tutorials/ui/custom_layouts.html"><strong aria-hidden="true">16.5.3.</strong> Custom Tab Layouts</a></li></ol></li></ol></li><li class="chapter-item "><a href="../../collaboration.html"><strong aria-hidden="true">17.</strong> Collaboration</a></li><li class="chapter-item "><a href="../../qa_pipeline/index.html"><strong aria-hidden="true">18.</strong> QA Pipeline</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../qa_pipeline/statistics.html"><strong aria-hidden="true">18.1.</strong> Statistics Tab</a></li><li class="chapter-item "><a href="../../qa_pipeline/profiler.html"><strong aria-hidden="true">18.2.</strong> Profiler Tab</a></li><li class="chapter-item "><a href="../../qa_pipeline/memory.html"><strong aria-hidden="true">18.3.</strong> Memory Usage Tab</a></li><li class="chapter-item "><a href="../../qa_pipeline/logging.html"><strong aria-hidden="true">18.4.</strong> Logging</a></li><li class="chapter-item "><a href="../../qa_pipeline/how_to_write_unit_tests.html"><strong aria-hidden="true">18.5.</strong> Write your own unit tests</a></li><li class="chapter-item "><a href="../../qa_pipeline/how_to_write_integration_tests.html"><strong aria-hidden="true">18.6.</strong> Write your own integration tests</a></li></ol></li><li class="chapter-item "><a href="../../build_tools/index.html"><strong aria-hidden="true">19.</strong> Build Tools</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../build_tools/tmbuild.html"><strong aria-hidden="true">19.1.</strong> How to use tmbuild</a></li><li class="chapter-item "><a href="../../build_tools/hash.html"><strong aria-hidden="true">19.2.</strong> How to use hash</a></li><li class="chapter-item "><a href="../../build_tools/tmbuild_package_reference.html"><strong aria-hidden="true">19.3.</strong> tmbuild package reference</a></li><li class="chapter-item "><a href="../../build_tools/libs_json_reference.html"><strong aria-hidden="true">19.4.</strong> Libs json reference</a></li><li class="chapter-item "><a href="../../build_tools/premake.html"><strong aria-hidden="true">19.5.</strong> Premake</a></li></ol></li><li class="chapter-item "><a href="../../writing_an_executable.html"><strong aria-hidden="true">20.</strong> Writing an executable</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Machinery Book</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/OurMachinery/themachinery-books" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="write-a-custom-component"><a class="header" href="#write-a-custom-component">Write a custom component</a></h1>
<p>This walkthrough shows you how to add a custom component to the Engine. During this walkthrough, we will cover the following topics:</p>
<ul>
<li>How to create a component from scratch.</li>
<li>Where and how do we register a component.</li>
</ul>
<p>You should have basic knowledge about how to write a custom plugin. If not, you might want to check this <a href="https://ourmachinery.github.io/themachinery-books/extending_the_machinery/the_plugin_system.html">Guide</a> and the <a href="https://ourmachinery.github.io/themachinery-books/extending_the_machinery/write-a-plugin.html#build-requirements">Write a plugin guide</a>. The goal of this walkthrough is to dissect the component plugin provided by the Engine.</p>
<p><strong>Table of Content</strong></p>
<ul>
<li>auto-gen TOC;
{:toc}</li>
</ul>
<h2 id="where-do-we-start"><a class="header" href="#where-do-we-start">Where do we start?</a></h2>
<p>In this example, we want to create a new plugin, which contains our component. We open the Engine go to <strong>file -&gt; New Plugin -&gt; Entity Component.</strong> The file dialog will pop up and ask us where we want to save our file. Pick a location that suits you.</p>
<blockquote>
<p><strong>Tip:</strong> Maybe store your plugin in a folder next to your game project.</p>
</blockquote>
<p>After this, we see that the Engine created some files for us. Now we need to ensure that we can build our project. In the root folder (The folder with the <code>premake</code> file), we run <code>tmbuild,</code> and if there is no issue, we see that it will build our projects once and generate the <code>.sln</code> file (on windows). If there is an issue, we should ensure we have set up the Environment variables correctly and installed all the needed dependencies. For more information, please read this <a href="https://ourmachinery.github.io/themachinery-books/build_tools/tmbuild.html">guide</a>.</p>
<p>Now we can open the <code>.c</code> file with our favourite IDE. The file will contain the following content:</p>
<pre><code class="language-c">static struct tm_entity_api *tm_entity_api;
static struct tm_transform_component_api *tm_transform_component_api;
static struct tm_temp_allocator_api *tm_temp_allocator_api;
static struct tm_the_truth_api *tm_the_truth_api;
static struct tm_localizer_api *tm_localizer_api;

#include &lt;plugins/entity/entity.h&gt;
#include &lt;plugins/entity/transform_component.h&gt;
#include &lt;plugins/the_machinery_shared/component_interfaces/editor_ui_interface.h&gt;

#include &lt;foundation/api_registry.h&gt;
#include &lt;foundation/carray.inl&gt;
#include &lt;foundation/localizer.h&gt;
#include &lt;foundation/math.inl&gt;
#include &lt;foundation/the_truth.h&gt;
#define TM_TT_TYPE__CUSTOM_COMPONENT &quot;tm_custom_component&quot;
#define TM_TT_TYPE_HASH__CUSTOM_COMPONENT TM_STATIC_HASH(&quot;tm_custom_component&quot;, 0x355309758b21930cULL)

enum
{
    TM_TT_PROP__CUSTOM_COMPONENT__FREQUENCY, // float
    TM_TT_PROP__CUSTOM_COMPONENT__AMPLITUDE, // float
};

struct tm_custom_component_t
{
    float y0;
    float frequency;
    float amplitude;
};
static const char *component__category(void)
{
    return TM_LOCALIZE(&quot;Samples&quot;);
}

static tm_ci_editor_ui_i *editor_aspect = &amp;(tm_ci_editor_ui_i){
    .category = component__category};
static void truth__create_types(struct tm_the_truth_o *tt)
{
    tm_the_truth_property_definition_t custom_component_properties[] = {
        [TM_TT_PROP__CUSTOM_COMPONENT__FREQUENCY] = {&quot;frequency&quot;, TM_THE_TRUTH_PROPERTY_TYPE_FLOAT},
        [TM_TT_PROP__CUSTOM_COMPONENT__AMPLITUDE] = {&quot;amplitude&quot;, TM_THE_TRUTH_PROPERTY_TYPE_FLOAT},
    };

    const tm_tt_type_t custom_component_type = tm_the_truth_api-&gt;create_object_type(tt, TM_TT_TYPE__CUSTOM_COMPONENT, custom_component_properties, TM_ARRAY_COUNT(custom_component_properties));
    const tm_tt_id_t default_object = tm_the_truth_api-&gt;quick_create_object(tt, TM_TT_NO_UNDO_SCOPE, TM_TT_TYPE_HASH__CUSTOM_COMPONENT, TM_TT_PROP__CUSTOM_COMPONENT__FREQUENCY, 1.0f, TM_TT_PROP__CUSTOM_COMPONENT__AMPLITUDE, 1.0f, -1);
    tm_the_truth_api-&gt;set_default_object(tt, custom_component_type, default_object);
    tm_tt_set_aspect(tt, custom_component_type, tm_ci_editor_ui_i, editor_aspect);
}
static bool component__load_asset(tm_component_manager_o *man, struct tm_entity_commands_o *commands, tm_entity_t e, void *c_vp, const tm_the_truth_o *tt, tm_tt_id_t asset)
{
    struct tm_custom_component_t *c = c_vp;
    const tm_the_truth_object_o *asset_r = tm_tt_read(tt, asset);
    c-&gt;y0 = 0;
    c-&gt;frequency = tm_the_truth_api-&gt;get_float(tt, asset_r, TM_TT_PROP__CUSTOM_COMPONENT__FREQUENCY);
    c-&gt;amplitude = tm_the_truth_api-&gt;get_float(tt, asset_r, TM_TT_PROP__CUSTOM_COMPONENT__AMPLITUDE);
    return true;
}
static void component__create(struct tm_entity_context_o *ctx)
{
    tm_component_i component = {
        .name = TM_TT_TYPE__CUSTOM_COMPONENT,
        .bytes = sizeof(struct tm_custom_component_t),
        .load_asset = component__load_asset,
    };

    tm_entity_api-&gt;register_component(ctx, &amp;component);
}
// Runs on (custom_component, transform_component)
static void engine_update__custom_component(tm_engine_o *inst, tm_engine_update_set_t *data, struct tm_entity_commands_o *commands)
{
    TM_INIT_TEMP_ALLOCATOR(ta);

    tm_entity_t *mod_transform = 0;

    struct tm_entity_context_o *ctx = (struct tm_entity_context_o *)inst;
    double t = 0;
    for (const tm_entity_blackboard_value_t *bb = data-&gt;blackboard_start; bb != data-&gt;blackboard_end; ++bb)
    {
        if (TM_STRHASH_EQUAL(bb-&gt;id, TM_ENTITY_BB__TIME))
            t = bb-&gt;double_value;
    }
    for (tm_engine_update_array_t *a = data-&gt;arrays; a &lt; data-&gt;arrays + data-&gt;num_arrays; ++a)
    {
        struct tm_custom_component_t *custom_component = a-&gt;components[0];
        tm_transform_component_t *transform = a-&gt;components[1];

        for (uint32_t i = 0; i &lt; a-&gt;n; ++i)
        {
            if (!custom_component[i].y0)
                custom_component[i].y0 = transform[i].world.pos.y;
            const float y = custom_component[i].y0 + custom_component[i].amplitude * sinf((float)t * custom_component[i].frequency);

            transform[i].world.pos.y = y;
            ++transform[i].version;
            tm_carray_temp_push(mod_transform, a-&gt;entities[i], ta);
        }
    }
    tm_entity_api-&gt;notify(ctx, data-&gt;engine-&gt;components[1], mod_transform, (uint32_t)tm_carray_size(mod_transform));
    TM_SHUTDOWN_TEMP_ALLOCATOR(ta);
}
static bool engine_filter__custom_component(tm_engine_o *inst, const tm_component_type_t *components, uint32_t num_components, const tm_component_mask_t *mask)
{
    return tm_entity_mask_has_component(mask, components[0]) &amp;&amp; tm_entity_mask_has_component(mask, components[1]);
}
static void component__register_engine(struct tm_entity_context_o *ctx)
{
    const tm_component_type_t custom_component = tm_entity_api-&gt;lookup_component_type(ctx, TM_TT_TYPE_HASH__CUSTOM_COMPONENT);
    const tm_component_type_t transform_component = tm_entity_api-&gt;lookup_component_type(ctx, TM_TT_TYPE_HASH__TRANSFORM_COMPONENT);

    const tm_engine_i custom_component_engine = {
        .ui_name = &quot;Custom Component&quot;,
        .hash = TM_STATIC_HASH(&quot;CUSTOM_COMPONENT&quot;, 0xe093a8316a6c2d29ULL),
        .num_components = 2,
        .components = {custom_component, transform_component},
        .writes = {false, true},
        .update = engine_update__custom_component,
        .filter = engine_filter__custom_component,
        .inst = (tm_engine_o *)ctx,
    };
    tm_entity_api-&gt;register_engine(ctx, &amp;custom_component_engine);
}

TM_DLL_EXPORT void tm_load_plugin(struct tm_api_registry_api *reg, bool load)
{
    tm_entity_api = tm_get_api(reg, tm_entity_api);
    tm_transform_component_api = tm_get_api(reg, tm_transform_component_api);
    tm_the_truth_api = tm_get_api(reg, tm_the_truth_api);
    tm_temp_allocator_api = tm_get_api(reg, tm_temp_allocator_api);
    tm_localizer_api = tm_get_api(reg, tm_localizer_api);

    tm_add_or_remove_implementation(reg, load, tm_the_truth_create_types_i, truth__create_types);
    tm_add_or_remove_implementation(reg, load, tm_entity_create_component_i, component__create);
    tm_add_or_remove_implementation(reg, load, tm_entity_register_engines_simulation_i, component__register_engine);
}
</code></pre>
<h2 id="code-structure"><a class="header" href="#code-structure">Code structure</a></h2>
<p>Let us dissect the code structure and discuss all the points of interest.</p>
<h3 id="api-and-include-region"><a class="header" href="#api-and-include-region">API and include region</a></h3>
<p>The file begins with all includes and API definitions: </p>
<pre><code class="language-c">static struct tm_entity_api *tm_entity_api;
static struct tm_transform_component_api *tm_transform_component_api;
static struct tm_temp_allocator_api *tm_temp_allocator_api;
static struct tm_the_truth_api *tm_the_truth_api;
static struct tm_localizer_api *tm_localizer_api;

#include &lt;plugins/entity/entity.h&gt;
#include &lt;plugins/entity/transform_component.h&gt;
#include &lt;plugins/the_machinery_shared/component_interfaces/editor_ui_interface.h&gt;

#include &lt;foundation/api_registry.h&gt;
#include &lt;foundation/carray.inl&gt;
#include &lt;foundation/localizer.h&gt;
#include &lt;foundation/math.inl&gt;
#include &lt;foundation/the_truth.h&gt;
</code></pre>
<p>The code will fill the API definitions with life in the <code>tm_load_plugin</code> function.</p>
<h3 id="define-your-data"><a class="header" href="#define-your-data">Define your Data</a></h3>
<p>The next part contains the Truth Definition of the component and the plain old data struct (POD). <em>In production, we should separate those aspects into a header file!</em></p>
<blockquote>
<p>Note: All components should be plain old data types.</p>
</blockquote>
<pre><code class="language-c">#define TM_TT_TYPE__CUSTOM_COMPONENT &quot;tm_custom_component&quot;
#define TM_TT_TYPE_HASH__CUSTOM_COMPONENT                                      \
  TM_STATIC_HASH(&quot;tm_custom_component&quot;, 0x355309758b21930cULL)

enum {
  TM_TT_PROP__CUSTOM_COMPONENT__FREQUENCY, // float
  TM_TT_PROP__CUSTOM_COMPONENT__AMPLITUDE, // float
};

struct tm_custom_component_t {
  float y0;
  float frequency;
  float amplitude;
};
</code></pre>
<h3 id="add-your-component-to-the-truth"><a class="header" href="#add-your-component-to-the-truth">Add your component to the Truth</a></h3>
<p>After this, we have the region in which we define the category of our component. The Editor will call it to categorize the component into the correct section. </p>
<p>We need to define a <a href="https://ourmachinery.com/apidoc/plugins/the_machinery_shared/component_interfaces/editor_ui_interface.h.html#structtm_ci_editor_ui_i"><code>tm_ci_editor_ui_i</code></a> object which uses this function.  Later we register this function to the <a href="https://ourmachinery.com/apidoc/plugins/the_machinery_shared/component_interfaces/editor_ui_interface.h.html#structtm_ci_editor_ui_i"><code>tm_ci_editor_ui_i</code></a> aspect of our truth type. If you do not add this aspect later to your Truth Type, the Editor will not know that this Component Type exists, and you can not add it via the Editor, but in C.</p>
<blockquote>
<p><strong>Note:</strong> More about aspects you can read in the <a href="#">aspects guide</a>.</p>
</blockquote>
<pre><code class="language-c">static const char *component__category(void) { return TM_LOCALIZE(&quot;Samples&quot;); }

static tm_ci_editor_ui_i *editor_aspect =
    &amp;(tm_ci_editor_ui_i){.category = component__category};
</code></pre>
<p>In this region, we create our component truth type. It is important to remember that the Truth will not reflect the runtime data, just the data you can edit in the Editor. On the other hand, the Entity Context will store your runtime data, the plain old data struct you have defined above. More about how this works later in this section.</p>
<p>Let us take this code apart one more time:</p>
<pre><code class="language-c">static void truth__create_types(struct tm_the_truth_o *tt) {
  tm_the_truth_property_definition_t custom_component_properties[] = {
      [TM_TT_PROP__CUSTOM_COMPONENT__FREQUENCY] =
          {&quot;frequency&quot;, TM_THE_TRUTH_PROPERTY_TYPE_FLOAT},
      [TM_TT_PROP__CUSTOM_COMPONENT__AMPLITUDE] =
          {&quot;amplitude&quot;, TM_THE_TRUTH_PROPERTY_TYPE_FLOAT},
  };

  const tm_tt_type_t custom_component_type =
      tm_the_truth_api-&gt;create_object_type(
          tt, TM_TT_TYPE__CUSTOM_COMPONENT, custom_component_properties,
          TM_ARRAY_COUNT(custom_component_properties));
  const tm_tt_id_t default_object = tm_the_truth_api-&gt;quick_create_object(
      tt, TM_TT_NO_UNDO_SCOPE, TM_TT_TYPE_HASH__CUSTOM_COMPONENT,
      TM_TT_PROP__CUSTOM_COMPONENT__FREQUENCY, 1.0f,
      TM_TT_PROP__CUSTOM_COMPONENT__AMPLITUDE, 1.0f, -1);
  tm_the_truth_api-&gt;set_default_object(tt, custom_component_type,
                                       default_object);
  tm_tt_set_aspect(tt, custom_component_type, tm_ci_editor_ui_i, editor_aspect);
}
</code></pre>
<ol>
<li>We define the component's properties.</li>
<li>We create the actual type in the Truth.</li>
<li>We create an object of our type with <code>quick_create_object</code> and provide a default object to our component. It makes sure that when you add the component to an Entity, you have the expected default values. It is not needed, just a nice thing to have.</li>
<li>Add our <a href="https://ourmachinery.com/apidoc/plugins/the_machinery_shared/component_interfaces/editor_ui_interface.h.html#structtm_ci_editor_ui_i"><code>tm_ci_editor_ui_i</code></a> aspect to the type. It tells the Editor that you can add the component via the Editor. If you do not provide it, the Editor will not suggest this component to you and cannot store it in the Truth. It does not mean you cannot add this component via C.</li>
</ol>
<h3 id="define-your-component"><a class="header" href="#define-your-component">Define your component</a></h3>
<p>You can register a component to the <a href="https://ourmachinery.com/apidoc/plugins/entity/entity.h.html#tm_entity_create_component_i"><code>tm_entity_create_component_i</code></a> in your plugin load function. This interface expects a function pointer to a create component function of the signature: <code>void tm_entity_create_component_i(struct tm_entity_context_o *ctx)</code>.</p>
<p>The Engine will call this function whenever it creates a new Entity Context to populate the context with all the known components. It usually happens at the beginning of the Simulation.</p>
<p>Within this function, you can define your component and register it to the context. The <a href="https://ourmachinery.com/apidoc/plugins/entity/entity.h.html#structtm_entity_api"><code>tm_entity_api</code></a> provides a function <a href="https://ourmachinery.com/apidoc/plugins/entity/entity.h.html#structtm_entity_api.register_component()"><code>tm_entity_api.register_component()</code></a> which expects the current context and an instance of the <a href="https://ourmachinery.com/apidoc/plugins/entity/entity.h.html#structtm_component_i"><code>tm_component_i</code></a>. We define one in our function and give it the needed information:</p>
<ul>
<li>A name should be the same as the Truth Type</li>
<li>The size of the component struct</li>
<li>A load asset function</li>
</ul>
<pre><code class="language-c">static void component__create(struct tm_entity_context_o *ctx) {
  tm_component_i component = {
      .name = TM_TT_TYPE__CUSTOM_COMPONENT,
      .bytes = sizeof(struct tm_custom_component_t),
      .load_asset = component__load_asset,
  };

  tm_entity_api-&gt;register_component(ctx, &amp;component);
}
</code></pre>
<p>As mentioned before, the Truth does not reflect the runtime data and only holds the data you can edit in the Editor. This is why there needs to be some translation between The Truth and the ECS. This magic is happening in the <a href="https://ourmachinery.com/apidoc/plugins/entity/entity.h.html#structtm_component_i.load_asset()"><code>tm_component_i.load_asset()</code></a>. This function allows you to translate a <a href="https://ourmachinery.com/apidoc/foundation/api_types.h.html#structtm_tt_id_t"><code>tm_tt_id_t</code></a> asset to the plain old data of the component.</p>
<pre><code class="language-c">static bool component__load_asset(tm_component_manager_o *man,
                                  struct tm_entity_commands_o *commands,
                                  tm_entity_t e, void *c_vp,
                                  const tm_the_truth_o *tt, tm_tt_id_t asset) {
  struct tm_custom_component_t *c = c_vp;
  const tm_the_truth_object_o *asset_r = tm_tt_read(tt, asset);
  c-&gt;y0 = 0;
  c-&gt;frequency = tm_the_truth_api-&gt;get_float(
      tt, asset_r, TM_TT_PROP__CUSTOM_COMPONENT__FREQUENCY);
  c-&gt;amplitude = tm_the_truth_api-&gt;get_float(
      tt, asset_r, TM_TT_PROP__CUSTOM_COMPONENT__AMPLITUDE);
  return true;
}
</code></pre>
<p>The first step is that we cast the given <code>void*</code> of the component data <code>c_vp</code> to the correct data type. After that, we load the data from the Truth and store it in the component. In the end, we return true because no error occurred.</p>
<h3 id="define-your-engine-update"><a class="header" href="#define-your-engine-update">Define your engine update</a></h3>
<p><em>In the Machinery, gameplay code is mainly driven by Systems and Engines. They define the behaviour while the components the data describes.</em> </p>
<blockquote>
<p><strong>Note:</strong> in some entity systems, these are referred to as <em>systems</em> instead, but we choose <em>Engine</em> because it is less ambiguous.</p>
</blockquote>
<p>This next section of the code is about defining an Engine.</p>
<pre><code class="language-c">// Runs on (custom_component, transform_component)
static void
engine_update__custom_component(tm_engine_o *inst, tm_engine_update_set_t *data,
                                struct tm_entity_commands_o *commands) {
  TM_INIT_TEMP_ALLOCATOR(ta);

  tm_entity_t *mod_transform = 0;

  struct tm_entity_context_o *ctx = (struct tm_entity_context_o *)inst;
  double t = 0;
  for (const tm_entity_blackboard_value_t *bb = data-&gt;blackboard_start;
       bb != data-&gt;blackboard_end; ++bb) {
    if (TM_STRHASH_EQUAL(bb-&gt;id, TM_ENTITY_BB__TIME))
      t = bb-&gt;double_value;
  }
  for (tm_engine_update_array_t *a = data-&gt;arrays;
       a &lt; data-&gt;arrays + data-&gt;num_arrays; ++a) {
    struct tm_custom_component_t *custom_component = a-&gt;components[0];
    tm_transform_component_t *transform = a-&gt;components[1];

    for (uint32_t i = 0; i &lt; a-&gt;n; ++i) {
      if (!custom_component[i].y0)
        custom_component[i].y0 = transform[i].world.pos.y;
      const float y = custom_component[i].y0 +
                      custom_component[i].amplitude *
                          sinf((float)t * custom_component[i].frequency);

      transform[i].world.pos.y = y;
      ++transform[i].version;
      tm_carray_temp_push(mod_transform, a-&gt;entities[i], ta);
    }
  }
  tm_entity_api-&gt;notify(ctx, data-&gt;engine-&gt;components[1], mod_transform,
                        (uint32_t)tm_carray_size(mod_transform));
  TM_SHUTDOWN_TEMP_ALLOCATOR(ta);
}
</code></pre>
<p>The first thing we do is use a temp allocator for any future allocation that will not leave this function. After that, we cast the <code>tm_engine_o* inst</code> to the <code>tm_entity_context_o*</code> so we have access to the entity context later on.</p>
<p>The next step is to get the time from the Blackboard Values. </p>
<pre><code class="language-c">double t = 0;
for (const tm_entity_blackboard_value_t *bb = data-&gt;blackboard_start;
     bb != data-&gt;blackboard_end; ++bb) {
  if (TM_STRHASH_EQUAL(bb-&gt;id, TM_ENTITY_BB__TIME))
    t = bb-&gt;double_value;
}
</code></pre>
<p>The Engine provides a bunch of useful Blackboard values. They are defined in the <code>plugins/entity/entity.h</code>.</p>
<ul>
<li><a href="https://ourmachinery.com/apidoc/plugins/entity/entity.h.html#tm_entity_bb__simulation_speed"><code>TM_ENTITY_BB__SIMULATION_SPEED</code></a> - Speed that the simulation is running at. Defaults to 1.0 for normal speed.</li>
<li><a href="https://ourmachinery.com/apidoc/plugins/entity/entity.h.html#tm_entity_bb__delta_time"><code>TM_ENTITY_BB__DELTA_TIME</code></a> - Blackboard item representing the simulation delta time of the current frame.</li>
<li><a href="https://ourmachinery.com/apidoc/plugins/entity/entity.h.html#tm_entity_bb__time"><code>TM_ENTITY_BB__TIME</code></a> - Blackboard item representing the total elapsed time in the Simulation.</li>
<li><a href="https://ourmachinery.com/apidoc/plugins/entity/entity.h.html#tm_entity_bb__wall_delta_time"><code>TM_ENTITY_BB__WALL_DELTA_TIME</code></a> - Blackboard item representing the wall delta time of the current frame. (Wall delta time is not affected by the Simulation being paused or run in slow motion.)</li>
<li><a href="https://ourmachinery.com/apidoc/plugins/entity/entity.h.html#tm_entity_bb__wall_time"><code>TM_ENTITY_BB__WALL_TIME</code></a> - Blackboard item representing the total elapsed wall time in the Simulation.</li>
<li><a href="https://ourmachinery.com/apidoc/plugins/entity/entity.h.html#tm_entity_bb__camera"><code>TM_ENTITY_BB__CAMERA</code></a> - Blackboard items for the current camera.</li>
<li><a href="https://ourmachinery.com/apidoc/plugins/entity/entity.h.html#tm_entity_bb__editor"><code>TM_ENTITY_BB__EDITOR</code></a> - Blackboard item that indicates that we are running in <em>Editor</em> mode. This may disable some components and/or simulation engines.</li>
<li><code>TM_ENTITY_BB__SIMULATING_IN_EDITOR</code> - Set to non-zero if the Simulation runs from within the Editor, such as running a game in the simulation tab. It will be zero when we run a game from the Runner. Note the distinction from <a href="https://ourmachinery.com//apidoc/plugins/entity/entity.h.html#tm_entity_bb__editor">TM_ENTITY_BB__EDITOR</a>.</li>
</ul>
<p>The <a href="https://ourmachinery.com/apidoc/plugins/entity/entity.h.html#structtm_engine_update_set_t"><code>tm_engine_update_set_t</code></a> gives us access to the needed data, and we can modify our components. The first important information we get are the number of entity types (also known Archetypes). This number is stored in <code>data-&gt;num_arrays</code>. Now that we know this information we can iterate over them and access the components per entity type. <code>tm_engine_update_array_t a =  data-&gt;arrays</code> (Gives us the current entity type's components). <code>a-&gt;n</code> is the number of matching components / entities of this entity type.</p>
<pre><code class="language-c">for (tm_engine_update_array_t *a = data-&gt;arrays;
     a &lt; data-&gt;arrays + data-&gt;num_arrays; ++a) {
  struct tm_custom_component_t *custom_component = a-&gt;components[0];
  tm_transform_component_t *transform = a-&gt;components[1];

  for (uint32_t i = 0; i &lt; a-&gt;n; ++i) {
    if (!custom_component[i].y0)
      custom_component[i].y0 = transform[i].world.pos.y;
    const float y = custom_component[i].y0 +
                    custom_component[i].amplitude *
                        sinf((float)t * custom_component[i].frequency);

    transform[i].world.pos.y = y;
    ++transform[i].version;
    tm_carray_temp_push(mod_transform, a-&gt;entities[i], ta);
  }
}
</code></pre>
<blockquote>
<p><strong>Note</strong>: In case you are not that familiar with C this loop:</p>
<pre><code class="language-c"> for (tm_engine_update_array_t* a = data-&gt;arrays; a &lt; data-&gt;arrays + data-&gt;num_arrays; ++a) {
</code></pre>
<p>is kind of the C equivalent to C++'s for each loop: <code>for(auto a : data-&gt;arrays)</code></p>
</blockquote>
<p>As the last step, we add a notifier function call to notify all entities that their components have changed.</p>
<pre><code class="language-c">tm_entity_api-&gt;notify(ctx, data-&gt;engine-&gt;components[1], mod_transform,
                      (uint32_t)tm_carray_size(mod_transform));
</code></pre>
<h3 id="register-your-engine-to-the-system"><a class="header" href="#register-your-engine-to-the-system">Register your Engine to the system</a></h3>
<p>You can register a component to the <a href="https://ourmachinery.com/apidoc/plugins/entity/entity.h.html#tm_entity_register_engines_simulation_i"><code>tm_entity_register_engines_simulation_i</code></a> in your plugin load function. This interface expects a function pointer to a create component function of the signature: <code>void tm_entity_register_engines_i(struct tm_entity_context_o *ctx)</code>. </p>
<p>The function itself looks as follows:</p>
<pre><code class="language-c">static void component__register_engine(struct tm_entity_context_o *ctx) {
  const tm_component_type_t custom_component =
      tm_entity_api-&gt;lookup_component_type(ctx,
                                           TM_TT_TYPE_HASH__CUSTOM_COMPONENT);
  const tm_component_type_t transform_component =
      tm_entity_api-&gt;lookup_component_type(
          ctx, TM_TT_TYPE_HASH__TRANSFORM_COMPONENT);

  const tm_engine_i custom_component_engine = {
      .ui_name = &quot;Custom Component&quot;,
      .hash = TM_STATIC_HASH(&quot;CUSTOM_COMPONENT&quot;, 0xe093a8316a6c2d29ULL),
      .num_components = 2,
      .components = {custom_component, transform_component},
      .writes = {false, true},
      .update = engine_update__custom_component,
      .filter = engine_filter__custom_component,
      .inst = (tm_engine_o *)ctx,
  };
  tm_entity_api-&gt;register_engine(ctx, &amp;custom_component_engine);
}
</code></pre>
<p>The first thing we do is to look up the component type. Did we register the type? If not, we will not get the correct type. Here we are using the name we defined beforehand in our component create function.</p>
<p>Then we ask for the transform component next because our Engine shall run on those two components.</p>
<p>After this, we define the actual instance of our engine struct</p>
<p><a href="https://ourmachinery.com/apidoc/plugins/entity/entity.h.html#structtm_engine_i"><code>tm_engine_i</code></a>. </p>
<p>We provide a <code>.ui_name</code> used in the Profiler to identify our Engine. Moreover, we add a unique string hash identifying this engine/system. This is used for scheduling the engine/system concerning other engines and systems, using the<code>before_me</code> and <code>after_me</code> fields.</p>
<p>Then we tell the system how many components the Engine shall operate on and which ones we will modify. This is used for scheduling the engines later one.</p>
<p>At last, we provide the needed update function, which we have discussed earlier, and a filter function.</p>
<pre><code class="language-c">static bool engine_filter__custom_component(
    tm_engine_o *inst, const tm_component_type_t *components,
    uint32_t num_components, const tm_component_mask_t *mask) {
  return tm_entity_mask_has_component(mask, components[0]) &amp;&amp;
         tm_entity_mask_has_component(mask, components[1]);
}
</code></pre>
<p>The filter function will be called on all entity types to determine if the Engine shall run on them or not.  To provide this function is optional. If present it specifies a filter function called for each entity type (as</p>
<p>represented by its component mask) to determine if the Engine should run on that entity type. If no <a href="https://ourmachinery.com/apidoc/plugins/entity/entity.h.html#structtm_engine_i.filter()"><code>tm_engine_i.filter()</code></a> function is supplied and no <code>excludes[]</code> flags are set, the update will run on entity types that have all the components in the <code>components</code> array. If some <code>excludes[]</code> flags are set, the Engine will run on all entity types that <strong>do not</strong> have any of the components whose <code>excludes[]</code> flags are set, but have all the other components in the <code>components</code> array. </p>
<blockquote>
<p><strong>Note:</strong> For more information, check the <a href="https://ourmachinery.com//apidoc/plugins/entity/entity.h.html#structtm_engine_i.filter()">documentation</a>.</p>
</blockquote>
<p>The last thing the register function needs to do is register the Engine to the Entity Context.</p>
<pre><code class="language-c"> tm_entity_api-&gt;register_engine(ctx, &amp;custom_component_engine);
</code></pre>
<h3 id="the-plugin-load-function"><a class="header" href="#the-plugin-load-function">The plugin load function</a></h3>
<p>The most important lines here are the once in which we register our truth types, the component and the engine.</p>
<pre><code class="language-c">TM_DLL_EXPORT void tm_load_plugin(struct tm_api_registry_api *reg, bool load) {
  tm_entity_api = tm_get_api(reg, tm_entity_api);
  tm_transform_component_api = tm_get_api(reg, tm_transform_component_api);
  tm_the_truth_api = tm_get_api(reg, tm_the_truth_api);
  tm_temp_allocator_api = tm_get_api(reg, tm_temp_allocator_api);
  tm_localizer_api = tm_get_api(reg, tm_localizer_api);

  tm_add_or_remove_implementation(reg, load, tm_the_truth_create_types_i,
                                  truth__create_types);
  tm_add_or_remove_implementation(reg, load, tm_entity_create_component_i,
                                  component__create);
  tm_add_or_remove_implementation(reg, load,
                                  tm_entity_register_engines_simulation_i,
                                  component__register_engine);
}
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../gameplay_coding/ecs/how_to_register_a_system_or_engine.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../../gameplay_coding/ecs/tagging_entities.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../gameplay_coding/ecs/how_to_register_a_system_or_engine.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../../gameplay_coding/ecs/tagging_entities.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
