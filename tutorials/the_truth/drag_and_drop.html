<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Adding Drag and Drop to Assets - The Machinery Book</title>
        <!-- Custom HTML head -->
<meta name="twitter:card" content="summary_large_image" />

<meta name="twitter:image" content="https://ourmachinery.com/images/machinery-logo.png" />
<meta name="twitter:title" content="Our Machinery">
<meta name="twitter:description" content="Our Machinery" />

<meta name="twitter:site" content="@ourmachinery" />


<meta property="og:title" content="Tutorials &middot; Our Machinery" />
<meta property="og:site_name" content="Our Machinery" />
<meta property="og:url" content="https://ourmachinery.com/tutorials/" />

<meta property="og:image" content="https://ourmachinery.com/images/machinery-logo.png" />


<meta property="og:type" content="website" />
<meta property="og:description" content="Our Machinery" />        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item "><a href="../../index.html"><strong aria-hidden="true">1.</strong> Welcome</a></li><li class="chapter-item "><a href="../../what_is_the_machinery.html"><strong aria-hidden="true">2.</strong> What is The Machinery</a></li><li class="chapter-item "><a href="../../licenses.html"><strong aria-hidden="true">3.</strong> Licenses</a></li><li class="chapter-item "><a href="../../faq.html"><strong aria-hidden="true">4.</strong> FAQ</a></li><li class="chapter-item "><a href="../../glossary.html"><strong aria-hidden="true">5.</strong> Glossary</a></li><li class="chapter-item "><a href="../../troubleshooting.html"><strong aria-hidden="true">6.</strong> Troubleshooting</a></li><li class="chapter-item "><a href="../../contributing.html"><strong aria-hidden="true">7.</strong> Contribution</a></li><li class="chapter-item "><a href="../../getting_started/index.html"><strong aria-hidden="true">8.</strong> Getting Started</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../getting_started/what_is_in_the_package.html"><strong aria-hidden="true">8.1.</strong> Contents of binary distribution</a></li><li class="chapter-item "><a href="../../getting_started/logging_in.html"><strong aria-hidden="true">8.2.</strong> Sign In</a></li><li class="chapter-item "><a href="../../getting_started/project_setup.html"><strong aria-hidden="true">8.3.</strong> Project Setup</a></li><li class="chapter-item "><a href="../../getting_started/version_control.html"><strong aria-hidden="true">8.4.</strong> Version Control</a></li><li class="chapter-item "><a href="../../getting_started/new_project.html"><strong aria-hidden="true">8.5.</strong> New Project</a></li><li class="chapter-item "><a href="../../getting_started/first_gameplay_project.html"><strong aria-hidden="true">8.6.</strong> First Gameplay Project</a></li><li class="chapter-item "><a href="../../getting_started/sample-projects.html"><strong aria-hidden="true">8.7.</strong> Sample Projects</a></li><li class="chapter-item "><a href="../../getting_started/migration_from_unity.html"><strong aria-hidden="true">8.8.</strong> The Machinery for Unity Dev's</a></li><li class="chapter-item "><a href="../../getting_started/migration_from_unreal.html"><strong aria-hidden="true">8.9.</strong> The Machinery for Unreal 4 Dev's</a></li><li class="chapter-item "><a href="../../getting_started/migration_from_godot.html"><strong aria-hidden="true">8.10.</strong> The Machinery for Godot Dev's</a></li><li class="chapter-item "><a href="../../getting_started/introduction_to_c/index.html"><strong aria-hidden="true">8.11.</strong> Introduction to C</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../getting_started/introduction_to_c/memory_management.html"><strong aria-hidden="true">8.11.1.</strong> Memory Management</a></li><li class="chapter-item "><a href="../../getting_started/introduction_to_c/list_arrays_vector.html"><strong aria-hidden="true">8.11.2.</strong> List, Arrays, Vectors</a></li><li class="chapter-item "><a href="../../getting_started/introduction_to_c/hashmaps_and_set.html"><strong aria-hidden="true">8.11.3.</strong> HashMaps &amp; Sets</a></li><li class="chapter-item "><a href="../../getting_started/introduction_to_c/concurrency.html"><strong aria-hidden="true">8.11.4.</strong> Concurrency in Machinery</a></li><li class="chapter-item "><a href="../../getting_started/introduction_to_c/strings.html"><strong aria-hidden="true">8.11.5.</strong> String processing</a></li><li class="chapter-item "><a href="../../getting_started/introduction_to_c/other.html"><strong aria-hidden="true">8.11.6.</strong> Types: void* and struct padding</a></li></ol></li></ol></li><li class="chapter-item "><a href="../../the_editor/index.html"><strong aria-hidden="true">9.</strong> The Editor</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../the_editor/tabs.html"><strong aria-hidden="true">9.1.</strong> About Tabs</a></li><li class="chapter-item "><a href="../../the_editor/entity_tree_tab.html"><strong aria-hidden="true">9.2.</strong> Entity Tree Tab</a></li><li class="chapter-item "><a href="../../the_editor/scene_tab.html"><strong aria-hidden="true">9.3.</strong> Scene Tab</a></li><li class="chapter-item "><a href="../../the_editor/properties_tab.html"><strong aria-hidden="true">9.4.</strong> Properties Tab</a></li><li class="chapter-item "><a href="../../the_editor/asset_browser.html"><strong aria-hidden="true">9.5.</strong> Asset Browser</a></li><li class="chapter-item "><a href="../../the_editor/simulate_tab.html"><strong aria-hidden="true">9.6.</strong> Simulate Tab</a></li><li class="chapter-item "><a href="../../the_editor/preview_tab.html"><strong aria-hidden="true">9.7.</strong> Preview Tab</a></li><li class="chapter-item "><a href="../../the_editor/customizations.html"><strong aria-hidden="true">9.8.</strong> Customizations</a></li></ol></li><li class="chapter-item "><a href="../../editing_workflows/index.html"><strong aria-hidden="true">10.</strong> Editing Workflows</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../editing_workflows/entities.html"><strong aria-hidden="true">10.1.</strong> Entities</a></li><li class="chapter-item "><a href="../../editing_workflows/import_assets.html"><strong aria-hidden="true">10.2.</strong> Import Assets</a></li><li class="chapter-item "><a href="../../editing_workflows/import_projects.html"><strong aria-hidden="true">10.3.</strong> Import Projects</a></li><li class="chapter-item "><a href="../../editing_workflows/asset_pipeline.html"><strong aria-hidden="true">10.4.</strong> Asset pipeline by Example</a></li><li class="chapter-item "><a href="../../editing_workflows/prototype_workflow/index.html"><strong aria-hidden="true">10.5.</strong> Prototypes</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../editing_workflows/prototype_workflow/how_to_create_prototypes.html"><strong aria-hidden="true">10.5.1.</strong> How to Create Prototypes</a></li><li class="chapter-item "><a href="../../editing_workflows/prototype_workflow/how_to_instantiate_prototypes.html"><strong aria-hidden="true">10.5.2.</strong> How to Instantiate Prototypes</a></li></ol></li><li class="chapter-item "><a href="../../editing_workflows/shaders_materials.html"><strong aria-hidden="true">10.6.</strong> Meshes / Materials / Shaders</a></li><li class="chapter-item "><a href="../../editing_workflows/simulation.html"><strong aria-hidden="true">10.7.</strong> Simulation</a></li><li class="chapter-item "><a href="../../editing_workflows/visual-scripting.html"><strong aria-hidden="true">10.8.</strong> Visual Scripting: Entity Graphs</a></li><li class="chapter-item "><a href="../../editing_workflows/physics.html"><strong aria-hidden="true">10.9.</strong> Physics</a></li><li class="chapter-item "><a href="../../editing_workflows/animation/index.html"><strong aria-hidden="true">10.10.</strong> Animation</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../editing_workflows/animation/animation-state-machine.html"><strong aria-hidden="true">10.10.1.</strong> Animation State Machines</a></li><li class="chapter-item "><a href="../../editing_workflows/animation/animation-compression.html"><strong aria-hidden="true">10.10.2.</strong> Animation Compression</a></li></ol></li><li class="chapter-item "><a href="../../editing_workflows/sound.html"><strong aria-hidden="true">10.11.</strong> Sound</a></li><li class="chapter-item "><a href="../../editing_workflows/publish.html"><strong aria-hidden="true">10.12.</strong> Publish</a></li><li class="chapter-item "><a href="../../editing_workflows/sculpting.html"><strong aria-hidden="true">10.13.</strong> Sculpt Tool / White boxing</a></li></ol></li><li class="chapter-item "><a href="../../the_truth/index.html"><strong aria-hidden="true">11.</strong> The Truth</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../the_truth/access_values.html"><strong aria-hidden="true">11.1.</strong> Access values</a></li><li class="chapter-item "><a href="../../the_truth/create_an_object.html"><strong aria-hidden="true">11.2.</strong> Create an object</a></li><li class="chapter-item "><a href="../../the_truth/modify_an_object.html"><strong aria-hidden="true">11.3.</strong> Modify an object</a></li><li class="chapter-item "><a href="../../the_truth/common_types.html"><strong aria-hidden="true">11.4.</strong> Common Types</a></li><li class="chapter-item "><a href="../../the_truth/aspects.html"><strong aria-hidden="true">11.5.</strong> Aspects</a></li><li class="chapter-item "><a href="../../the_truth/custom_truth_type.html"><strong aria-hidden="true">11.6.</strong> Create a Truth Type</a></li></ol></li><li class="chapter-item "><a href="../../creation_graphs/concept.html"><strong aria-hidden="true">12.</strong> Creation Graphs</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../creation_graphs/intro_unity.html"><strong aria-hidden="true">12.1.</strong> Creation Graphs for Untiy Dev's</a></li><li class="chapter-item "><a href="../../creation_graphs/intro_unreal.html"><strong aria-hidden="true">12.2.</strong> Creation Graphs for Unreal 4 Dev's</a></li><li class="chapter-item "><a href="../../creation_graphs/node_types.html"><strong aria-hidden="true">12.3.</strong> Node Types</a></li><li class="chapter-item "><a href="../../creation_graphs/shader_system.html"><strong aria-hidden="true">12.4.</strong> Shader System Interaction</a></li></ol></li><li class="chapter-item "><a href="../../graphics/index.html"><strong aria-hidden="true">13.</strong> Graphics</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../graphics/camera/index.html"><strong aria-hidden="true">13.1.</strong> Camera</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../graphics/camera/physical_light_and_camera.html"><strong aria-hidden="true">13.1.1.</strong> Physically Based Light and Cameras</a></li></ol></li><li class="chapter-item "><a href="../../graphics/default_render_pipeline.html"><strong aria-hidden="true">13.2.</strong> Default Render Pipeline</a></li><li class="chapter-item "><a href="../../graphics/mesh_materials.html"><strong aria-hidden="true">13.3.</strong> Meshes / Materials</a></li><li class="chapter-item "><a href="../../graphics/shaders.html"><strong aria-hidden="true">13.4.</strong> Shaders</a></li><li class="chapter-item "><a href="../../graphics/the_machinery_shading_language.html"><strong aria-hidden="true">13.5.</strong> The Machinery Shading Language</a></li><li class="chapter-item "><a href="../../graphics/tmsl_vs.html"><strong aria-hidden="true">13.6.</strong> .tmsl Visual Studio Extension</a></li><li class="chapter-item "><a href="../../graphics/post_processing/index.html"><strong aria-hidden="true">13.7.</strong> Post Processing</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../graphics/post_processing/aa.html"><strong aria-hidden="true">13.7.1.</strong> Anti-Aliasing</a></li><li class="chapter-item "><a href="../../graphics/post_processing/exposure.html"><strong aria-hidden="true">13.7.2.</strong> Exposure</a></li><li class="chapter-item "><a href="../../graphics/post_processing/bloom.html"><strong aria-hidden="true">13.7.3.</strong> Bloom</a></li><li class="chapter-item "><a href="../../graphics/post_processing/color_grading.html"><strong aria-hidden="true">13.7.4.</strong> Color Grading</a></li></ol></li></ol></li><li class="chapter-item "><a href="../../extending_the_machinery/index.html"><strong aria-hidden="true">14.</strong> Extending The Machinery</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../extending_the_machinery/the_plugin_system.html"><strong aria-hidden="true">14.1.</strong> The Plugin System</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../extending_the_machinery/write-a-plugin.html"><strong aria-hidden="true">14.1.1.</strong> Write a plugin</a></li><li class="chapter-item "><a href="../../extending_the_machinery/sample_plugin.html"><strong aria-hidden="true">14.1.2.</strong> Sample Plugins</a></li><li class="chapter-item "><a href="../../extending_the_machinery/write-a-tab.html"><strong aria-hidden="true">14.1.3.</strong> Write a tab</a></li><li class="chapter-item "><a href="../../extending_the_machinery/plugin-assets.html"><strong aria-hidden="true">14.1.4.</strong> Plugin assets</a></li></ol></li><li class="chapter-item "><a href="../../extending_the_machinery/hot-reloading.html"><strong aria-hidden="true">14.2.</strong> Hot-reloading</a></li><li class="chapter-item "><a href="../../extending_the_machinery/application_hooks.html"><strong aria-hidden="true">14.3.</strong> Application Hooks</a></li><li class="chapter-item "><a href="../../build_tools/premake.html"><strong aria-hidden="true">14.4.</strong> Premake</a></li><li class="chapter-item "><a href="../../build_tools/tmbuild.html"><strong aria-hidden="true">14.5.</strong> tmbuild</a></li></ol></li><li class="chapter-item "><a href="../../gameplay_coding/index.html"><strong aria-hidden="true">15.</strong> Gameplay coding</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../gameplay_coding/simulation_entry.html"><strong aria-hidden="true">15.1.</strong> Simulation Entry in C</a></li><li class="chapter-item "><a href="../../gameplay_coding/visual_scripting/index.html"><strong aria-hidden="true">15.2.</strong> Visual Scripting</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../gameplay_coding/visual_scripting/subgraphs.html"><strong aria-hidden="true">15.2.1.</strong> Subgraphs</a></li><li class="chapter-item "><a href="../../gameplay_coding/visual_scripting/debugger.html"><strong aria-hidden="true">15.2.2.</strong> Debugger</a></li><li class="chapter-item "><a href="../../gameplay_coding/visual_scripting/extend_the_entity_graph.html"><strong aria-hidden="true">15.2.3.</strong> Extending the Entity Graph</a></li><li class="chapter-item "><a href="../../gameplay_coding/visual_scripting/provide_custom_data_type_to_the_entity_graph.html"><strong aria-hidden="true">15.2.4.</strong> Custom Data Type for the Entity Graph</a></li></ol></li><li class="chapter-item "><a href="../../gameplay_coding/ecs/index.html"><strong aria-hidden="true">15.3.</strong> Entity Component System</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../gameplay_coding/ecs/what_are_components.html"><strong aria-hidden="true">15.3.1.</strong> What are components</a></li><li class="chapter-item "><a href="../../gameplay_coding/ecs/how_entites_can_interact.html"><strong aria-hidden="true">15.3.2.</strong> How can Entities Interact?</a></li><li class="chapter-item "><a href="../../gameplay_coding/ecs/how_to_design_system_or_engine.html"><strong aria-hidden="true">15.3.3.</strong> How to design a System or an Engine?</a></li><li class="chapter-item "><a href="../../gameplay_coding/ecs/how_to_define_a_engine_system.html"><strong aria-hidden="true">15.3.4.</strong> How to define a System or an Engine?</a></li><li class="chapter-item "><a href="../../gameplay_coding/ecs/how_to_register_a_system_or_engine.html"><strong aria-hidden="true">15.3.5.</strong> How to register a System or an Engine?</a></li><li class="chapter-item "><a href="../../gameplay_coding/ecs/write_a_custom_component.html"><strong aria-hidden="true">15.3.6.</strong> Write a custom component</a></li><li class="chapter-item "><a href="../../gameplay_coding/ecs/tagging_entities.html"><strong aria-hidden="true">15.3.7.</strong> Tagging Entities</a></li><li class="chapter-item "><a href="../../gameplay_coding/ecs/filtering_entities.html"><strong aria-hidden="true">15.3.8.</strong> Filtering Entities</a></li><li class="chapter-item "><a href="../../gameplay_coding/ecs/simulation_lifecycle.html"><strong aria-hidden="true">15.3.9.</strong> Simulation Lifecycle</a></li></ol></li><li class="chapter-item "><a href="../../gameplay_coding/gameplay_entry_comparison.html"><strong aria-hidden="true">15.4.</strong> Gameplay Entry Point Comparison</a></li></ol></li><li class="chapter-item expanded "><a href="../../tutorials/index.html"><strong aria-hidden="true">16.</strong> Tutorials</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../tutorials/creation_graph/index.html"><strong aria-hidden="true">16.1.</strong> Creation Graph</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../tutorials/creation_graph/introduction_walkthrough/index.html"><strong aria-hidden="true">16.1.1.</strong> Creation Graph Introduction Series</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../tutorials/creation_graph/introduction_walkthrough/texture_compression.html"><strong aria-hidden="true">16.1.1.1.</strong> Simple Texture Compression</a></li><li class="chapter-item "><a href="../../tutorials/creation_graph/introduction_walkthrough/creation_graph_prototype.html"><strong aria-hidden="true">16.1.1.2.</strong> Creation Graph Prototype</a></li><li class="chapter-item "><a href="../../tutorials/creation_graph/introduction_walkthrough/custom_import_settings.html"><strong aria-hidden="true">16.1.1.3.</strong> Custom Import Settings</a></li></ol></li><li class="chapter-item "><a href="../../tutorials/creation_graph/custom_gpu_nodes.html"><strong aria-hidden="true">16.1.2.</strong> Creating Custom GPU Nodes</a></li><li class="chapter-item "><a href="../../tutorials/creation_graph/custom_cpu_nodes.html"><strong aria-hidden="true">16.1.3.</strong> Creating Custom CPU Nodes</a></li><li class="chapter-item "><a href="../../tutorials/creation_graph/custom_geometry_node.html"><strong aria-hidden="true">16.1.4.</strong> Creating Custom Geometry Nodes</a></li><li class="chapter-item "><a href="../../tutorials/creation_graph/from_code.html"><strong aria-hidden="true">16.1.5.</strong> Calling Creation Graphs from Code</a></li><li class="chapter-item "><a href="../../tutorials/creation_graph/raymarch_output_node.html"><strong aria-hidden="true">16.1.6.</strong> Creating a Custom Raymarching Output Node</a></li></ol></li><li class="chapter-item "><a href="../../tutorials/physics/index.html"><strong aria-hidden="true">16.2.</strong> Physics</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../tutorials/physics/triggers.html"><strong aria-hidden="true">16.2.1.</strong> Triggers</a></li><li class="chapter-item "><a href="../../tutorials/physics/arkanoid.html"><strong aria-hidden="true">16.2.2.</strong> Arkanoid</a></li><li class="chapter-item "><a href="../../tutorials/physics/contacts.html"><strong aria-hidden="true">16.2.3.</strong> Contacts</a></li><li class="chapter-item "><a href="../../tutorials/physics/kinematic.html"><strong aria-hidden="true">16.2.4.</strong> Kinematic</a></li><li class="chapter-item "><a href="../../tutorials/physics/stack.html"><strong aria-hidden="true">16.2.5.</strong> Stack</a></li></ol></li><li class="chapter-item expanded "><a href="../../tutorials/the_truth/index.html"><strong aria-hidden="true">16.3.</strong> The Truth</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../tutorials/the_truth/custom_asset/index.html"><strong aria-hidden="true">16.3.1.</strong> Creating a Custom Asset Type</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../tutorials/the_truth/custom_asset/part1.html"><strong aria-hidden="true">16.3.1.1.</strong> Part 1 - Create an Asset Truth Type, Addable via Asset Browser</a></li><li class="chapter-item "><a href="../../tutorials/the_truth/custom_asset/part2.html"><strong aria-hidden="true">16.3.1.2.</strong> Part 2 - Custom UI</a></li><li class="chapter-item "><a href="../../tutorials/the_truth/custom_asset/part3.html"><strong aria-hidden="true">16.3.1.3.</strong> Part 3 - Custom Importer</a></li></ol></li><li class="chapter-item expanded "><a href="../../tutorials/the_truth/drag_and_drop.html" class="active"><strong aria-hidden="true">16.3.2.</strong> Adding Drag and Drop to Assets</a></li><li class="chapter-item "><a href="../../tutorials/the_truth/open_asset.html"><strong aria-hidden="true">16.3.3.</strong> Open Asset in Tab</a></li></ol></li><li class="chapter-item "><a href="../../tutorials/network/index.html"><strong aria-hidden="true">16.4.</strong> Network</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../tutorials/network/animation_sample/network_assets.html"><strong aria-hidden="true">16.4.1.</strong> Part 1: Network Asset</a></li><li class="chapter-item "><a href="../../tutorials/network/animation_sample/multiple_network_instances.html"><strong aria-hidden="true">16.4.2.</strong> Part 2: Multiple Instances</a></li><li class="chapter-item "><a href="../../tutorials/network/animation_sample/entity_control.html"><strong aria-hidden="true">16.4.3.</strong> Part 3: Entity Control</a></li><li class="chapter-item "><a href="../../tutorials/network/animation_sample/support_multiple_players.html"><strong aria-hidden="true">16.4.4.</strong> Part 4: Multiple Players</a></li><li class="chapter-item "><a href="../../tutorials/network/animation_sample/basic_graph_variables.html"><strong aria-hidden="true">16.4.5.</strong> Part 5: Variable Replication (Graph)</a></li><li class="chapter-item "><a href="../../tutorials/network/animation_sample/smooth_animation.html"><strong aria-hidden="true">16.4.6.</strong> Part 6: Smooth Animation</a></li><li class="chapter-item "><a href="../../tutorials/network/animation_sample/spawning_entities.html"><strong aria-hidden="true">16.4.7.</strong> Part 7: Spawning Entities</a></li></ol></li><li class="chapter-item "><a href="../../tutorials/ui/index.html"><strong aria-hidden="true">16.5.</strong> UI</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../tutorials/ui/build_custom_ui_controls/index.html"><strong aria-hidden="true">16.5.1.</strong> Build Custom UI Controls</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../tutorials/ui/build_custom_ui_controls/part1.html"><strong aria-hidden="true">16.5.1.1.</strong> Part 1</a></li></ol></li><li class="chapter-item "><a href="../../tutorials/ui/toolbars-overlays.html"><strong aria-hidden="true">16.5.2.</strong> Toolbars and Overlays</a></li><li class="chapter-item "><a href="../../tutorials/ui/custom_layouts.html"><strong aria-hidden="true">16.5.3.</strong> Custom Tab Layouts</a></li></ol></li></ol></li><li class="chapter-item "><a href="../../collaboration.html"><strong aria-hidden="true">17.</strong> Collaboration</a></li><li class="chapter-item "><a href="../../qa_pipeline/index.html"><strong aria-hidden="true">18.</strong> QA Pipeline</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../qa_pipeline/statistics.html"><strong aria-hidden="true">18.1.</strong> Statistics Tab</a></li><li class="chapter-item "><a href="../../qa_pipeline/profiler.html"><strong aria-hidden="true">18.2.</strong> Profiler Tab</a></li><li class="chapter-item "><a href="../../qa_pipeline/memory.html"><strong aria-hidden="true">18.3.</strong> Memory Usage Tab</a></li><li class="chapter-item "><a href="../../qa_pipeline/logging.html"><strong aria-hidden="true">18.4.</strong> Logging</a></li><li class="chapter-item "><a href="../../qa_pipeline/how_to_write_unit_tests.html"><strong aria-hidden="true">18.5.</strong> Write your own unit tests</a></li><li class="chapter-item "><a href="../../qa_pipeline/how_to_write_integration_tests.html"><strong aria-hidden="true">18.6.</strong> Write your own integration tests</a></li></ol></li><li class="chapter-item "><a href="../../build_tools/index.html"><strong aria-hidden="true">19.</strong> Build Tools</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../build_tools/tmbuild.html"><strong aria-hidden="true">19.1.</strong> How to use tmbuild</a></li><li class="chapter-item "><a href="../../build_tools/hash.html"><strong aria-hidden="true">19.2.</strong> How to use hash</a></li><li class="chapter-item "><a href="../../build_tools/tmbuild_package_reference.html"><strong aria-hidden="true">19.3.</strong> tmbuild package reference</a></li><li class="chapter-item "><a href="../../build_tools/libs_json_reference.html"><strong aria-hidden="true">19.4.</strong> Libs json reference</a></li><li class="chapter-item "><a href="../../build_tools/premake.html"><strong aria-hidden="true">19.5.</strong> Premake</a></li></ol></li><li class="chapter-item "><a href="../../writing_an_executable.html"><strong aria-hidden="true">20.</strong> Writing an executable</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Machinery Book</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/OurMachinery/themachinery-books" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="adding-drag-and-drop-to-assets"><a class="header" href="#adding-drag-and-drop-to-assets">Adding Drag and Drop to Assets</a></h1>
<p>This walkthrough shows you how to enable a asset to be drag and dropped. You should have basic knowledge about how to write a custom plugin. If not, you might want to check this <a href="https://ourmachinery.github.io/themachinery-books/the_machinery_book/extending_the_machinery/the_plugin_system.html">Guide</a>. The goal of this walkthrough is to enable you to drag and drop your asset into the Scene! </p>
<p>You will learn:</p>
<ul>
<li>how to use an aspect in practice</li>
<li>How to extend an already existing asset.</li>
<li>How to use an entity-component manager.</li>
</ul>
<p>This walkthrough will refer to the text asset example as the asset we want to extend! If you have not followed it here is the link: <a href="https://ourmachinery.github.io/themachinery-books/tutorials/the_truth/custom_asset/index.html">Custom Asset</a></p>
<p><strong>Table of Content</strong></p>
<ul>
<li><a href="#adding-drag-and-drop-to-our-asset">Adding Drag and Drop to our asset</a>
<ul>
<li><a href="#asset-scene-aspect">Asset Scene Aspect</a></li>
</ul>
</li>
<li><a href="#the-story-component">The story component</a>
<ul>
<li><a href="#custom-ui">Custom UI</a></li>
</ul>
</li>
<li><a href="#using-the-asset-picker-property-aspect">Using the Asset Picker Property Aspect</a></li>
<li><a href="#drag-and-drop-a-text-asset-into-the-scene-and-create-an-entity">Drag and drop a Text Asset into the Scene and create an entity</a></li>
<li><a href="#modify-a-already-existing-asset">Modify a already existing asset</a></li>
</ul>
<h2 id="adding-drag-and-drop-to-our-asset"><a class="header" href="#adding-drag-and-drop-to-our-asset">Adding Drag and Drop to our asset</a></h2>
<p>In this example, we are going back to our text asset sample. In that sample, we have the following function to register the asset to the Truth:</p>
<pre><code class="language-c">static void create_truth_types(struct tm_the_truth_o *tt) {
  static tm_the_truth_property_definition_t my_asset_properties[] = {
      {&quot;import_path&quot;, TM_THE_TRUTH_PROPERTY_TYPE_STRING},
      {&quot;data&quot;, TM_THE_TRUTH_PROPERTY_TYPE_BUFFER},
  };
  const tm_tt_type_t type = tm_the_truth_api-&gt;create_object_type(
      tt, TM_TT_TYPE__MY_ASSET, my_asset_properties,
      TM_ARRAY_COUNT(my_asset_properties));
  tm_tt_set_aspect(tt, type, tm_tt_assets_file_extension_aspect_i, &quot;txt&quot;);
  static tm_properties_aspect_i properties_aspect = {
      .custom_ui = properties__custom_ui,
  };

  tm_tt_set_aspect(tt, type, tm_properties_aspect_i, &amp;properties_aspect);
  tm_the_truth_property_definition_t story_component_properties[] = {
      [TM_TT_PROP__STORY_COMPONENT__ASSET] = {
          &quot;story_asset&quot;, .type = TM_THE_TRUTH_PROPERTY_TYPE_REFERENCE,
          .type_hash = TM_TT_TYPE_HASH__MY_ASSET}};
}
</code></pre>
<p>We need to make use of the <a href="https://ourmachinery.com/apidoc/plugins/the_machinery_shared/asset_aspects.h.html#structtm_asset_scene_api"><code>tm_asset_scene_api</code></a> aspect. This aspect allows the associated Truth Type to be dragged and dropped to the Scene if wanted! We can find it in the <code>plugins/the_machinery_shared/asset_aspects.h</code> header.</p>
<h3 id="asset-scene-aspect"><a class="header" href="#asset-scene-aspect">Asset Scene Aspect</a></h3>
<blockquote>
<p><em>What is an aspect?</em> <a href="https://ourmachinery.github.io/themachinery-books//the_truth/aspects.html">Custom Asset</a></p>
</blockquote>
<p>This aspect expects an instance of the <a href="https://ourmachinery.com/apidoc/plugins/the_machinery_shared/asset_aspects.h.html#structtm_asset_scene_api"><code>tm_asset_scene_api</code></a>. When we provide a call-back called</p>
<p><code>bool (*droppable)(struct tm_asset_scene_o *inst, struct tm_the_truth_o *tt, tm_tt_id_t asset);</code> we tell the scene that we can drag the asset out of the asset browser. We need to return true for this. In this case you need to provide the <code>create_entity</code> function. When you drag your asset into the Scene, this function is called by the Engine. In this function, you can create a new entity and attach it to the parent entity ( which might be the world.  If you drag it on top of another entity, you can attach the newly created entity as a child entity to this one. </p>
<p>Before we can make use of this we need some component to be created for our Text Asset! Lets call it Story Component.</p>
<h2 id="the-story-component"><a class="header" href="#the-story-component">The story component</a></h2>
<p>Let us create a use case for our text file. Let us assume we wanted to make a very simple story-based game, and all our text files are the basis for our stories. This means we need to create first a story component.</p>
<blockquote>
<p><strong>Note</strong>: For more details on how to create a component, follow this <a href="https://ourmachinery.github.io/themachinery-books//gameplay_coding/ecs/write_a_custom_component.html">guide</a>.</p>
</blockquote>
<p>Here we have the whole source code for the story component:</p>
<pre><code class="language-c">// more apis
static struct tm_entity_api *tm_entity_api;
// more includes
#include &lt;plugins/entity/entity.h&gt;
#include &lt;plugins/the_machinery_shared/component_interfaces/editor_ui_interface.h&gt;
// more code

static const char *component__category(void) { return TM_LOCALIZE(&quot;Story&quot;); }

static tm_ci_editor_ui_i *editor_aspect =
    &amp;(tm_ci_editor_ui_i){.category = component__category};

{{insert_code(env.TM_BOOK_CODE_SNIPPETS/custom_assets/drag_drop/txt.c,create_truth_types,off)}}

struct tm_component_manager_o {
  tm_entity_context_o *ctx;
  tm_allocator_i allocator;
};
static bool component__load_asset(tm_component_manager_o *man,
                                  struct tm_entity_commands_o *commands,
                                  tm_entity_t e, void *c_vp,
                                  const tm_the_truth_o *tt, tm_tt_id_t asset) {
  struct tm_story_component_t *c = c_vp;
  const tm_the_truth_object_o *asset_r = tm_tt_read(tt, asset);
  tm_tt_id_t id = tm_the_truth_api-&gt;get_reference(
      tt, asset_r, TM_TT_PROP__STORY_COMPONENT__ASSET);
  if (id.u64) {
    tm_tt_buffer_t buffer = tm_the_truth_api-&gt;get_buffer(
        tt, tm_tt_read(tt, id), TM_TT_PROP__MY_ASSET__DATA);
    c-&gt;text = tm_alloc(&amp;man-&gt;allocator, buffer.size);
    c-&gt;size = buffer.size;
    memcpy(c-&gt;text, buffer.data, buffer.size);
  }
  return true;
}
static void component__remove(tm_component_manager_o *manager,
                              struct tm_entity_commands_o *commands,
                              tm_entity_t e, void *data) {
  tm_story_component_t *sc = (tm_story_component_t *)data;
  tm_free(&amp;manager-&gt;allocator, sc-&gt;text, sc-&gt;size);
}

static void component__destroy(tm_component_manager_o *manager) {
  // Free the actual manager struct and the allocator used to allocate it.
  tm_entity_context_o *ctx = manager-&gt;ctx;
  tm_allocator_i allocator = manager-&gt;allocator;
  tm_free(&amp;allocator, manager, sizeof(tm_component_manager_o));
  tm_entity_api-&gt;destroy_child_allocator(ctx, &amp;allocator);
}
static void component__create(struct tm_entity_context_o *ctx) {
  // Allocate a new manager for this component type (freed in
  // component__destroy).
  tm_allocator_i allocator;
  tm_entity_api-&gt;create_child_allocator(ctx, TM_TT_TYPE__STORY_COMPONENT,
                                        &amp;allocator);
  tm_component_manager_o *story_manager =
      tm_alloc(&amp;allocator, sizeof(tm_component_manager_o));

  *story_manager = (tm_component_manager_o){.ctx = ctx, .allocator = allocator};

  tm_component_i component = {.name = TM_TT_TYPE__STORY_COMPONENT,
                              .bytes = sizeof(struct tm_story_component_t),
                              .load_asset = component__load_asset,
                              .destroy = component__destroy,
                              .remove = component__remove,
                              .manager =
                                  (tm_component_manager_o *)story_manager};
  tm_entity_api-&gt;register_component(ctx, &amp;component);
};

// -- load plugin
TM_DLL_EXPORT void tm_load_plugin(struct tm_api_registry_api *reg, bool load) {
  tm_the_truth_api = tm_get_api(reg, tm_the_truth_api);
  tm_properties_view_api = tm_get_api(reg, tm_properties_view_api);
  tm_os_api = tm_get_api(reg, tm_os_api);
  tm_path_api = tm_get_api(reg, tm_path_api);
  tm_temp_allocator_api = tm_get_api(reg, tm_temp_allocator_api);
  tm_allocator_api = tm_get_api(reg, tm_allocator_api);
  tm_logger_api = tm_get_api(reg, tm_logger_api);
  tm_localizer_api = tm_get_api(reg, tm_localizer_api);
  tm_asset_io_api = tm_get_api(reg, tm_asset_io_api);
  task_system = tm_get_api(reg, tm_task_system_api);
  tm_sprintf_api = tm_get_api(reg, tm_sprintf_api);
  tm_entity_api = tm_get_api(reg, tm_entity_api);
  tm_scene_common_api = tm_get_api(reg, tm_scene_common_api);
  tm_global_api_registry = reg;
  if (load)
    tm_asset_io_api-&gt;add_asset_io(&amp;txt_asset_io);
  else
    tm_asset_io_api-&gt;remove_asset_io(&amp;txt_asset_io);

  tm_add_or_remove_implementation(reg, load, tm_entity_create_component_i,
                                  component__create);
  tm_add_or_remove_implementation(reg, load, tm_the_truth_create_types_i,
                                  create_truth_types);
  tm_add_or_remove_implementation(reg, load, tm_asset_browser_create_asset_i,
                                  &amp;asset_browser_create_my_asset);
}

</code></pre>
<p>First, we create our component, and we need a way to guarantee that our truth data exists during runtime as well. Therefore, we use the Entity Manager to allocate our Story data and store just a pointer and its size to the allocated data in the Manager.</p>
<pre><code class="language-c">struct tm_component_manager_o {
  tm_entity_context_o *ctx;
  tm_allocator_i allocator;
};
static void component__create(struct tm_entity_context_o *ctx) {
  // Allocate a new manager for this component type (freed in
  // component__destroy).
  tm_allocator_i allocator;
  tm_entity_api-&gt;create_child_allocator(ctx, TM_TT_TYPE__STORY_COMPONENT,
                                        &amp;allocator);
  tm_component_manager_o *story_manager =
      tm_alloc(&amp;allocator, sizeof(tm_component_manager_o));

  *story_manager = (tm_component_manager_o){.ctx = ctx, .allocator = allocator};

  tm_component_i component = {.name = TM_TT_TYPE__STORY_COMPONENT,
                              .bytes = sizeof(struct tm_story_component_t),
                              .load_asset = component__load_asset,
                              .destroy = component__destroy,
                              .remove = component__remove,
                              .manager =
                                  (tm_component_manager_o *)story_manager};
  tm_entity_api-&gt;register_component(ctx, &amp;component);
};
</code></pre>
<p>The most important function here is the <code>component__load_asset</code> function, in which we translate the Truth Representation into an ECS representation. We load the text buffer, allocate it with the Manager, and store a pointer in our component. With this, we could create a reference-counted system in which multiple components point to the same story data, and only when the last component goes we deallocate this. Another alternative would be to avoid loading when we create the component, and the story is already allocated.</p>
<pre><code class="language-c">static bool component__load_asset(tm_component_manager_o *man,
                                  struct tm_entity_commands_o *commands,
                                  tm_entity_t e, void *c_vp,
                                  const tm_the_truth_o *tt, tm_tt_id_t asset) {
  struct tm_story_component_t *c = c_vp;
  const tm_the_truth_object_o *asset_r = tm_tt_read(tt, asset);
  tm_tt_id_t id = tm_the_truth_api-&gt;get_reference(
      tt, asset_r, TM_TT_PROP__STORY_COMPONENT__ASSET);
  if (id.u64) {
    tm_tt_buffer_t buffer = tm_the_truth_api-&gt;get_buffer(
        tt, tm_tt_read(tt, id), TM_TT_PROP__MY_ASSET__DATA);
    c-&gt;text = tm_alloc(&amp;man-&gt;allocator, buffer.size);
    c-&gt;size = buffer.size;
    memcpy(c-&gt;text, buffer.data, buffer.size);
  }
  return true;
}
</code></pre>
<p>When the Entity context gets destroyed, we need to clean up and destroy our Manager. Important that we call <code>call_remove_on_all_entities</code> to make sure all instances of the component are gone.</p>
<pre><code class="language-c">static void component__remove(tm_component_manager_o *manager,
                              struct tm_entity_commands_o *commands,
                              tm_entity_t e, void *data) {
  tm_story_component_t *sc = (tm_story_component_t *)data;
  tm_free(&amp;manager-&gt;allocator, sc-&gt;text, sc-&gt;size);
}

static void component__destroy(tm_component_manager_o *manager) {
  // Free the actual manager struct and the allocator used to allocate it.
  tm_entity_context_o *ctx = manager-&gt;ctx;
  tm_allocator_i allocator = manager-&gt;allocator;
  tm_free(&amp;allocator, manager, sizeof(tm_component_manager_o));
  tm_entity_api-&gt;destroy_child_allocator(ctx, &amp;allocator);
}
</code></pre>
<h4 id="custom-ui"><a class="header" href="#custom-ui">Custom UI</a></h4>
<p><strong>This part is optional!</strong>, see next part where we use the <code>TM_TT_PROP_ASPECT__PROPERTIES__ASSET_PICKER</code>.</p>
<p>We also can to provide a custom UI for our reference to the asset! When we define our Truth type we tell the system that it should be a reference <strong>only</strong> of type <code>TM_TT_TYPE_HASH__TXT_ASSET</code>.</p>
<pre><code class="language-c">tm_the_truth_property_definition_t story_component_properties[] = {
    [TM_TT_PROP__STORY_COMPONENT__ASSET] = {
        &quot;story_asset&quot;, .type = TM_THE_TRUTH_PROPERTY_TYPE_REFERENCE,
        .type_hash = TM_TT_TYPE_HASH__MY_ASSET}};
</code></pre>
<p>This makes sure that in the Editor the user cannot store any other Truth type in this property. The Truth will check for it</p>
<p>We need to add the <code>TM_TT_ASPECT__PROPERTIES</code> aspect to our type to make sure it has a custom UI.</p>
<pre><code class="language-c">static tm_properties_aspect_i properties_component_aspect = {
    .custom_ui = properties__component_custom_ui,
};

const tm_tt_type_t story_component_type = tm_the_truth_api-&gt;create_object_type(
    tt, TM_TT_TYPE__STORY_COMPONENT, story_component_properties,
    TM_ARRAY_COUNT(story_component_properties));
tm_tt_set_aspect(tt, story_component_type, tm_ci_editor_ui_i, editor_aspect);
tm_tt_set_aspect(tt, story_component_type, tm_properties_aspect_i,
                 &amp;properties_component_aspect);
</code></pre>
<p>And than we need to define our custom UI:</p>
<pre><code class="language-c">static float
properties__component_custom_ui(struct tm_properties_ui_args_t *args,
                                tm_rect_t item_rect, tm_tt_id_t object) {
  TM_INIT_TEMP_ALLOCATOR(ta);
  tm_tt_type_t asset_type = tm_the_truth_api-&gt;object_type_from_name_hash(
      args-&gt;tt, TM_TT_TYPE_HASH__ASSET);
  tm_tt_id_t *ids = tm_the_truth_api-&gt;all_objects_of_type(
      args-&gt;tt,
      tm_the_truth_api-&gt;object_type_from_name_hash(args-&gt;tt,
                                                   TM_TT_TYPE_HASH__MY_ASSET),
      ta);
  tm_tt_id_t *items = 0;
  const char **names = 0;
  tm_carray_temp_push(names, &quot;Select&quot;, ta);
  tm_carray_temp_push(items, (tm_tt_id_t){0}, ta);
  for (uint32_t i = 0; i &lt; tm_carray_size(ids); ++i) {
    tm_tt_id_t owner = tm_the_truth_api-&gt;owner(args-&gt;tt, ids[i]);
    if (tm_tt_type(owner).u64 == asset_type.u64) {
      tm_carray_temp_push(
          names,
          tm_the_truth_api-&gt;get_string(args-&gt;tt, tm_tt_read(args-&gt;tt, owner),
                                       TM_TT_PROP__ASSET__NAME),
          ta);
      tm_carray_temp_push(items, ids[i], ta);
    }
  }
  item_rect.y = tm_properties_view_api-&gt;ui_reference_popup_picker(
      args, item_rect, &quot;Asset&quot;, NULL, object,
      TM_TT_PROP__STORY_COMPONENT__ASSET, names, items,
      (uint32_t)tm_carray_size(items));
  TM_SHUTDOWN_TEMP_ALLOCATOR(ta);
  return item_rect.y;
}
</code></pre>
<p>In there we get all objects of type <code>TM_TT_TYPE_HASH__TXT_ASSET</code> we know that this type can only exist as a sub object of the Asset Truth Type.</p>
<blockquote>
<p>The type can only be created a part of the asset at this point!</p>
</blockquote>
<p>This information is important because we need a name for our asset and therefore we just iterate over all our TXT Assets and check if they are owned by a Truth Asset type. If yes we get the name from it and store it in a names array. At the end we add all the IDs of the objects in a array so the user can select them in the drop down menu of the <a href="https://ourmachinery.com/apidoc/plugins/editor_views/properties.h.html#structtm_properties_view_api.ui_reference_popup_picker()"><code>tm_properties_view_api.ui_reference_popup_picker()</code></a>.</p>
<h2 id="using-the-asset-picker-property-aspect"><a class="header" href="#using-the-asset-picker-property-aspect">Using the Asset Picker Property Aspect</a></h2>
<p>Instead of implementing our own UI, which can be full of boilerplate code we can also use the following aspect on our truth type: <code>TM_TT_PROP_ASPECT__PROPERTIES__ASSET_PICKER</code> or if we want to store a entity an provide a entity from the scene: <code>TM_TT_PROP_ASPECT__PROPERTIES__USE_LOCAL_ENTITY_PICKER</code>. The following code can be adjusted. In your <code>create_truth_types()</code> we need to add this aspect to our type property like this:</p>
<pre><code class="language-c">static tm_properties_aspect_i properties_component_aspect = {
    .custom_ui = properties__component_custom_ui,
};

const tm_tt_type_t story_component_type = tm_the_truth_api-&gt;create_object_type(
    tt, TM_TT_TYPE__STORY_COMPONENT, story_component_properties,
    TM_ARRAY_COUNT(story_component_properties));
tm_tt_set_aspect(tt, story_component_type, tm_ci_editor_ui_i, editor_aspect);
tm_tt_set_aspect(tt, story_component_type, tm_properties_aspect_i,
                 &amp;properties_component_aspect);
tm_tt_set_property_aspect(tt, story_component_type, TM_TT_PROP__STORY_COMPONENT__ASSET, tm_tt_prop_aspect__properties__asset_picker, TM_TT_TYPE__MY_ASSET);
}
</code></pre>
<h2 id="drag-and-drop-a-text-asset-into-the-scene-and-create-an-entity"><a class="header" href="#drag-and-drop-a-text-asset-into-the-scene-and-create-an-entity">Drag and drop a Text Asset into the Scene and create an entity</a></h2>
<p>Finally, we can do what we came here to do: Make our Asset drag and droppable! We make use of the <code>TM_TT_ASPECT__ASSET_SCENE</code>!</p>
<p>We define the aspect as described above:</p>
<pre><code class="language-c">#include &lt;plugins/the_machinery_shared/asset_aspects.h&gt;
tm_asset_scene_api scene_api = {
    .droppable = droppable,
    .create_entity = create_entity,
};
</code></pre>
<p>In the Create Truth Type function you need to add the aspect <code>TM_TT_ASPECT__ASSET_SCENE</code>:</p>
<pre><code class="language-c">static void create_truth_types(struct tm_the_truth_o *tt) {
  static tm_the_truth_property_definition_t my_asset_properties[] = {
      {&quot;import_path&quot;, TM_THE_TRUTH_PROPERTY_TYPE_STRING},
      {&quot;data&quot;, TM_THE_TRUTH_PROPERTY_TYPE_BUFFER},
  };
  const tm_tt_type_t type = tm_the_truth_api-&gt;create_object_type(
      tt, TM_TT_TYPE__MY_ASSET, my_asset_properties,
      TM_ARRAY_COUNT(my_asset_properties));
  tm_tt_set_aspect(tt, type, tm_tt_assets_file_extension_aspect_i, &quot;txt&quot;);
  static tm_properties_aspect_i properties_aspect = {
      .custom_ui = properties__custom_ui,
  };

  tm_tt_set_aspect(tt, type, tm_properties_aspect_i, &amp;properties_aspect);
  tm_the_truth_property_definition_t story_component_properties[] = {
      [TM_TT_PROP__STORY_COMPONENT__ASSET] = {
          &quot;story_asset&quot;, .type = TM_THE_TRUTH_PROPERTY_TYPE_REFERENCE,
          .type_hash = TM_TT_TYPE_HASH__MY_ASSET}};
}
//..
}
</code></pre>
<p>Than, we provide a <code>droppable()</code> function:</p>
<pre><code class="language-c">bool droppable(struct tm_asset_scene_o *inst, struct tm_the_truth_o *tt,
               tm_tt_id_t asset) {
  return true;
}
</code></pre>
<p>After this, the more important function comes:</p>
<pre><code class="language-c">#include &lt;plugins/entity/transform_component.h&gt;
#include &lt;plugins/the_machinery_shared/scene_common.h&gt;
// ... more code
tm_tt_id_t create_entity(struct tm_asset_scene_o *inst,
                         struct tm_the_truth_o *tt, tm_tt_id_t asset,
                         const char *name,
                         const tm_transform_t *local_transform,
                         tm_tt_id_t parent_entity, tm_tt_id_t asset_root,
                         struct tm_undo_stack_i *undo_stack,
                         tm_tt_undo_scope_t parent_undo_scope) {
  const tm_tt_undo_scope_t undo_scope = tm_the_truth_api-&gt;create_undo_scope(
      tt, TM_LOCALIZE(&quot;Create Entity From Creation Graph&quot;));
  const tm_tt_type_t entity_type =
      tm_the_truth_api-&gt;object_type_from_name_hash(tt, TM_TT_TYPE_HASH__ENTITY);
  const tm_tt_id_t entity =
      tm_the_truth_api-&gt;create_object_of_type(tt, entity_type, undo_scope);
  tm_the_truth_object_o *entity_w = tm_the_truth_api-&gt;write(tt, entity);
  tm_the_truth_api-&gt;set_string(tt, entity_w, TM_TT_PROP__ENTITY__NAME, name);
  // add transform:
  {
    const tm_tt_type_t transform_component_type =
        tm_the_truth_api-&gt;object_type_from_name_hash(
            tt, TM_TT_TYPE_HASH__TRANSFORM_COMPONENT);
    const tm_tt_id_t component = tm_the_truth_api-&gt;create_object_of_type(
        tt, transform_component_type, undo_scope);
    tm_the_truth_object_o *component_w = tm_the_truth_api-&gt;write(tt, component);
    tm_the_truth_api-&gt;add_to_subobject_set(
        tt, entity_w, TM_TT_PROP__ENTITY__COMPONENTS, &amp;component_w, 1);
    tm_the_truth_api-&gt;commit(tt, component_w, undo_scope);
  }
  // add story:
  {
    tm_tt_type_t asset_type = tm_the_truth_api-&gt;object_type_from_name_hash(
        tt, TM_TT_TYPE_HASH__STORY_COMPONENT);
    const tm_tt_id_t component =
        tm_the_truth_api-&gt;create_object_of_type(tt, asset_type, undo_scope);
    tm_the_truth_object_o *component_w = tm_the_truth_api-&gt;write(tt, component);
    tm_the_truth_api-&gt;set_reference(tt, component_w,
                                    TM_TT_PROP__STORY_COMPONENT__ASSET, asset);
    tm_the_truth_api-&gt;add_to_subobject_set(
        tt, entity_w, TM_TT_PROP__ENTITY__COMPONENTS, &amp;component_w, 1);
    tm_the_truth_api-&gt;commit(tt, component_w, undo_scope);
  }

  tm_the_truth_api-&gt;commit(tt, entity_w, undo_scope);

  tm_scene_common_api-&gt;place_entity(tt, entity, local_transform, parent_entity,
                                    undo_scope);

  undo_stack-&gt;add(undo_stack-&gt;inst, tt, undo_scope);

  return entity;
}
</code></pre>
<p>First, we create an entity:</p>
<pre><code class="language-c">tm_tt_id_t create_entity(struct tm_asset_scene_o *inst,
                         struct tm_the_truth_o *tt, tm_tt_id_t asset,
                         const char *name,
                         const tm_transform_t *local_transform,
                         tm_tt_id_t parent_entity, tm_tt_id_t asset_root,
                         struct tm_undo_stack_i *undo_stack,
                         tm_tt_undo_scope_t parent_undo_scope) {
  const tm_tt_undo_scope_t undo_scope = tm_the_truth_api-&gt;create_undo_scope(
      tt, TM_LOCALIZE(&quot;Create Entity From Creation Graph&quot;));
  const tm_tt_type_t entity_type =
      tm_the_truth_api-&gt;object_type_from_name_hash(tt, TM_TT_TYPE_HASH__ENTITY);
  const tm_tt_id_t entity =
      tm_the_truth_api-&gt;create_object_of_type(tt, entity_type, undo_scope);
  tm_the_truth_object_o *entity_w = tm_the_truth_api-&gt;write(tt, entity);
  tm_the_truth_api-&gt;set_string(tt, entity_w, TM_TT_PROP__ENTITY__NAME, name);
//...
}
</code></pre>
<p>Suppose it needs a transform. If not, we don't! In this case, we add the transform to the entity, just to make a point:</p>
<pre><code class="language-c">tm_tt_id_t create_entity(struct tm_asset_scene_o *inst,
                         struct tm_the_truth_o *tt, tm_tt_id_t asset,
                         const char *name,
                         const tm_transform_t *local_transform,
                         tm_tt_id_t parent_entity, tm_tt_id_t asset_root,
                         struct tm_undo_stack_i *undo_stack,
                         tm_tt_undo_scope_t parent_undo_scope) {
  const tm_tt_undo_scope_t undo_scope = tm_the_truth_api-&gt;create_undo_scope(
      tt, TM_LOCALIZE(&quot;Create Entity From Creation Graph&quot;));
  const tm_tt_type_t entity_type =
      tm_the_truth_api-&gt;object_type_from_name_hash(tt, TM_TT_TYPE_HASH__ENTITY);
  const tm_tt_id_t entity =
      tm_the_truth_api-&gt;create_object_of_type(tt, entity_type, undo_scope);
  tm_the_truth_object_o *entity_w = tm_the_truth_api-&gt;write(tt, entity);
  tm_the_truth_api-&gt;set_string(tt, entity_w, TM_TT_PROP__ENTITY__NAME, name);
  // add transform:
  {
    const tm_tt_type_t transform_component_type =
        tm_the_truth_api-&gt;object_type_from_name_hash(
            tt, TM_TT_TYPE_HASH__TRANSFORM_COMPONENT);
    const tm_tt_id_t component = tm_the_truth_api-&gt;create_object_of_type(
        tt, transform_component_type, undo_scope);
    tm_the_truth_object_o *component_w = tm_the_truth_api-&gt;write(tt, component);
    tm_the_truth_api-&gt;add_to_subobject_set(
        tt, entity_w, TM_TT_PROP__ENTITY__COMPONENTS, &amp;component_w, 1);
    tm_the_truth_api-&gt;commit(tt, component_w, undo_scope);
  }
    // ...
}
</code></pre>
<p>Then, we add the story component to the entity we follow the same steps as before.</p>
<pre><code class="language-c">tm_tt_id_t create_entity(struct tm_asset_scene_o *inst,
                         struct tm_the_truth_o *tt, tm_tt_id_t asset,
                         const char *name,
                         const tm_transform_t *local_transform,
                         tm_tt_id_t parent_entity, tm_tt_id_t asset_root,
                         struct tm_undo_stack_i *undo_stack,
                         tm_tt_undo_scope_t parent_undo_scope) {
  const tm_tt_undo_scope_t undo_scope = tm_the_truth_api-&gt;create_undo_scope(
      tt, TM_LOCALIZE(&quot;Create Entity From Creation Graph&quot;));
  const tm_tt_type_t entity_type =
      tm_the_truth_api-&gt;object_type_from_name_hash(tt, TM_TT_TYPE_HASH__ENTITY);
  const tm_tt_id_t entity =
      tm_the_truth_api-&gt;create_object_of_type(tt, entity_type, undo_scope);
  tm_the_truth_object_o *entity_w = tm_the_truth_api-&gt;write(tt, entity);
  tm_the_truth_api-&gt;set_string(tt, entity_w, TM_TT_PROP__ENTITY__NAME, name);
  // add transform:
  {
    const tm_tt_type_t transform_component_type =
        tm_the_truth_api-&gt;object_type_from_name_hash(
            tt, TM_TT_TYPE_HASH__TRANSFORM_COMPONENT);
    const tm_tt_id_t component = tm_the_truth_api-&gt;create_object_of_type(
        tt, transform_component_type, undo_scope);
    tm_the_truth_object_o *component_w = tm_the_truth_api-&gt;write(tt, component);
    tm_the_truth_api-&gt;add_to_subobject_set(
        tt, entity_w, TM_TT_PROP__ENTITY__COMPONENTS, &amp;component_w, 1);
    tm_the_truth_api-&gt;commit(tt, component_w, undo_scope);
  }
  // add story:
  {
    tm_tt_type_t asset_type = tm_the_truth_api-&gt;object_type_from_name_hash(
        tt, TM_TT_TYPE_HASH__STORY_COMPONENT);
    const tm_tt_id_t component =
        tm_the_truth_api-&gt;create_object_of_type(tt, asset_type, undo_scope);
    tm_the_truth_object_o *component_w = tm_the_truth_api-&gt;write(tt, component);
    tm_the_truth_api-&gt;set_reference(tt, component_w,
                                    TM_TT_PROP__STORY_COMPONENT__ASSET, asset);
    tm_the_truth_api-&gt;add_to_subobject_set(
        tt, entity_w, TM_TT_PROP__ENTITY__COMPONENTS, &amp;component_w, 1);
    tm_the_truth_api-&gt;commit(tt, component_w, undo_scope);
  }
}
</code></pre>
<p>After all this, we can commit our changes to the Truth. After this we could place it in the scene with the <a href="https://ourmachinery.com/apidoc/plugins/the_machinery_shared/scene_common.h.html#structtm_scene_common_api.place_entity()"><code>tm_scene_common_api.place_entity()</code></a>. This step is not needed but is nice to do!</p>
<p>Do not forget to add the undo scope to make sure we can undo our action and return the created entity!</p>
<pre><code class="language-c">tm_tt_id_t create_entity(struct tm_asset_scene_o *inst,
                         struct tm_the_truth_o *tt, tm_tt_id_t asset,
                         const char *name,
                         const tm_transform_t *local_transform,
                         tm_tt_id_t parent_entity, tm_tt_id_t asset_root,
                         struct tm_undo_stack_i *undo_stack,
                         tm_tt_undo_scope_t parent_undo_scope) {
  const tm_tt_undo_scope_t undo_scope = tm_the_truth_api-&gt;create_undo_scope(
      tt, TM_LOCALIZE(&quot;Create Entity From Creation Graph&quot;));
  const tm_tt_type_t entity_type =
      tm_the_truth_api-&gt;object_type_from_name_hash(tt, TM_TT_TYPE_HASH__ENTITY);
  const tm_tt_id_t entity =
      tm_the_truth_api-&gt;create_object_of_type(tt, entity_type, undo_scope);
  tm_the_truth_object_o *entity_w = tm_the_truth_api-&gt;write(tt, entity);
  tm_the_truth_api-&gt;set_string(tt, entity_w, TM_TT_PROP__ENTITY__NAME, name);
  // add transform:
  {
    const tm_tt_type_t transform_component_type =
        tm_the_truth_api-&gt;object_type_from_name_hash(
            tt, TM_TT_TYPE_HASH__TRANSFORM_COMPONENT);
    const tm_tt_id_t component = tm_the_truth_api-&gt;create_object_of_type(
        tt, transform_component_type, undo_scope);
    tm_the_truth_object_o *component_w = tm_the_truth_api-&gt;write(tt, component);
    tm_the_truth_api-&gt;add_to_subobject_set(
        tt, entity_w, TM_TT_PROP__ENTITY__COMPONENTS, &amp;component_w, 1);
    tm_the_truth_api-&gt;commit(tt, component_w, undo_scope);
  }
  // add story:
  {
    tm_tt_type_t asset_type = tm_the_truth_api-&gt;object_type_from_name_hash(
        tt, TM_TT_TYPE_HASH__STORY_COMPONENT);
    const tm_tt_id_t component =
        tm_the_truth_api-&gt;create_object_of_type(tt, asset_type, undo_scope);
    tm_the_truth_object_o *component_w = tm_the_truth_api-&gt;write(tt, component);
    tm_the_truth_api-&gt;set_reference(tt, component_w,
                                    TM_TT_PROP__STORY_COMPONENT__ASSET, asset);
    tm_the_truth_api-&gt;add_to_subobject_set(
        tt, entity_w, TM_TT_PROP__ENTITY__COMPONENTS, &amp;component_w, 1);
    tm_the_truth_api-&gt;commit(tt, component_w, undo_scope);
  }

  tm_the_truth_api-&gt;commit(tt, entity_w, undo_scope);

  tm_scene_common_api-&gt;place_entity(tt, entity, local_transform, parent_entity,
                                    undo_scope);

  undo_stack-&gt;add(undo_stack-&gt;inst, tt, undo_scope);

  return entity;
}
</code></pre>
<p>Now we have added the ability to add this to our asset!</p>
<blockquote>
<p><strong>Note:</strong> This is all not done at run time, since we are dealing with the Truth here and not with the ECS our changes will apply first to the ECS when we simulate the game!</p>
</blockquote>
<h2 id="modify-a-already-existing-asset"><a class="header" href="#modify-a-already-existing-asset">Modify a already existing asset</a></h2>
<p>It is important to understand that you can add this to any truth type even if you do not define them in your plugin. Lets assume you have created a new plugin which uses the txt file asset. You are not the owner of this plugin and its source code so you cannot modify it like we did above. What you can do on the other hand you can add the aspect to the truth type:</p>
<pre><code class="language-c">// -- load plugin
TM_DLL_EXPORT void tm_load_plugin(struct tm_api_registry_api *reg, bool load) {
  tm_the_truth_api = tm_get_api(reg, tm_the_truth_api);
  tm_properties_view_api = tm_get_api(reg, tm_properties_view_api);
  tm_os_api = tm_get_api(reg, tm_os_api);
  tm_path_api = tm_get_api(reg, tm_path_api);
  tm_temp_allocator_api = tm_get_api(reg, tm_temp_allocator_api);
  tm_allocator_api = tm_get_api(reg, tm_allocator_api);
  tm_logger_api = tm_get_api(reg, tm_logger_api);
  tm_localizer_api = tm_get_api(reg, tm_localizer_api);
  tm_asset_io_api = tm_get_api(reg, tm_asset_io_api);
  task_system = tm_get_api(reg, tm_task_system_api);
  tm_sprintf_api = tm_get_api(reg, tm_sprintf_api);
  tm_entity_api = tm_get_api(reg, tm_entity_api);
  tm_scene_common_api = tm_get_api(reg, tm_scene_common_api);
  tm_global_api_registry = reg;
  if (load)
    tm_asset_io_api-&gt;add_asset_io(&amp;txt_asset_io);
  else
    tm_asset_io_api-&gt;remove_asset_io(&amp;txt_asset_io);

  tm_add_or_remove_implementation(reg, load, tm_entity_create_component_i,
                                  component__create);
  tm_add_or_remove_implementation(reg, load, tm_the_truth_create_types_i,
                                  create_truth_types);
  tm_add_or_remove_implementation(reg, load, tm_asset_browser_create_asset_i,
                                  &amp;asset_browser_create_my_asset);
}
</code></pre>
<p>and then in the <code>create_truth_types</code> function you can add the aspect to the truth type:</p>
<pre><code class="language-c">// -- create truth type
static void create_truth_types_modify(struct tm_the_truth_o *tt) {
  tm_tt_type_t asset_type = tm_the_truth_api-&gt;object_type_from_name_hash(
      tt, TM_TT_TYPE_HASH__MY_ASSET);
  if (asset_type.u64) {
    if (tm_tt_get_aspect(tt, asset_type, tm_asset_scene_api))
      tm_tt_set_aspect(tt, asset_type, tm_asset_scene_api, &amp;scene_api);
  }
}
</code></pre>
<p>In here we get the <code>asset_type</code> from the Truth. Important here is we need to make sure the type exists already! if not it makes no sense to add the aspect to it. More over we need to make sure that the asset has not already this aspect. Since a Object can have only one aspect at the same time!</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../tutorials/the_truth/custom_asset/part3.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../../tutorials/the_truth/open_asset.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../tutorials/the_truth/custom_asset/part3.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../../tutorials/the_truth/open_asset.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
