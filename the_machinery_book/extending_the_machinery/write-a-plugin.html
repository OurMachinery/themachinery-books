<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Write a plugin - The Machinery Book</title>
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="../favicon.svg">
                        <link rel="shortcut icon" href="../favicon.png">
                <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
                <link rel="stylesheet" href="../css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="../fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item "><a href="../index.html"><strong aria-hidden="true">1.</strong> Welcome</a></li><li class="chapter-item "><a href="../what_is_the_machinery.html"><strong aria-hidden="true">2.</strong> What is The Machinery</a></li><li class="chapter-item "><a href="../licenses.html"><strong aria-hidden="true">3.</strong> Licenses</a></li><li class="chapter-item "><a href="../glossary.html"><strong aria-hidden="true">4.</strong> Glossary</a></li><li class="chapter-item "><a href="../troubleshooting.html"><strong aria-hidden="true">5.</strong> Troubleshooting</a></li><li class="chapter-item "><a href="../getting_started/index.html"><strong aria-hidden="true">6.</strong> Getting Started</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../getting_started/what_is_in_the_package.html"><strong aria-hidden="true">6.1.</strong> What is in this package</a></li><li class="chapter-item "><a href="../getting_started/logging_in.html"><strong aria-hidden="true">6.2.</strong> Sign In</a></li><li class="chapter-item "><a href="../getting_started/project_setup.html"><strong aria-hidden="true">6.3.</strong> Project Setup</a></li><li class="chapter-item "><a href="../getting_started/new_project.html"><strong aria-hidden="true">6.4.</strong> New Project</a></li><li class="chapter-item "><a href="../getting_started/first_gameplay_project.html"><strong aria-hidden="true">6.5.</strong> First Gameplay Project</a></li><li class="chapter-item "><a href="../getting_started/sample-projects.html"><strong aria-hidden="true">6.6.</strong> Sample Projects</a></li><li class="chapter-item "><a href="../getting_started/migration_from_unity.html"><strong aria-hidden="true">6.7.</strong> The Machinery for Unity Dev's</a></li><li class="chapter-item "><a href="../getting_started/migration_from_unreal.html"><strong aria-hidden="true">6.8.</strong> The Machinery for Unreal 4 Dev's</a></li><li class="chapter-item "><a href="../getting_started/migration_from_godot.html"><strong aria-hidden="true">6.9.</strong> The Machinery for Godot Dev's</a></li><li class="chapter-item "><a href="../getting_started/introduction_to_c.html"><strong aria-hidden="true">6.10.</strong> Introduction to C</a></li></ol></li><li class="chapter-item "><a href="../the_editor/index.html"><strong aria-hidden="true">7.</strong> The Editor</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../the_editor/tabs.html"><strong aria-hidden="true">7.1.</strong> About Tabs</a></li><li class="chapter-item "><a href="../the_editor/entity_tree_tab.html"><strong aria-hidden="true">7.2.</strong> Entity Tree Tab</a></li><li class="chapter-item "><a href="../the_editor/scene_tab.html"><strong aria-hidden="true">7.3.</strong> Scene Tab</a></li><li class="chapter-item "><a href="../the_editor/properties_tab.html"><strong aria-hidden="true">7.4.</strong> Properties Tab</a></li><li class="chapter-item "><a href="../the_editor/asset_browser.html"><strong aria-hidden="true">7.5.</strong> Asset Browser</a></li><li class="chapter-item "><a href="../the_editor/simulate_tab.html"><strong aria-hidden="true">7.6.</strong> Simulate Tab</a></li><li class="chapter-item "><a href="../the_editor/preview_tab.html"><strong aria-hidden="true">7.7.</strong> Preview Tab</a></li><li class="chapter-item "><a href="../the_editor/customizations.html"><strong aria-hidden="true">7.8.</strong> Customizations</a></li></ol></li><li class="chapter-item "><a href="../editing_workflows/index.html"><strong aria-hidden="true">8.</strong> Editing Workflows</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../editing_workflows/entities.html"><strong aria-hidden="true">8.1.</strong> Entities</a></li><li class="chapter-item "><a href="../editing_workflows/import_assets.html"><strong aria-hidden="true">8.2.</strong> Import Assets</a></li><li class="chapter-item "><a href="../editing_workflows/import_projects.html"><strong aria-hidden="true">8.3.</strong> Import Projects</a></li><li class="chapter-item "><a href="../editing_workflows/asset_pipeline.html"><strong aria-hidden="true">8.4.</strong> Asset pipeline by Example</a></li><li class="chapter-item "><a href="../editing_workflows/shaders_materials.html"><strong aria-hidden="true">8.5.</strong> Meshes / Materials / Shaders</a></li><li class="chapter-item "><a href="../editing_workflows/prototypes.html"><strong aria-hidden="true">8.6.</strong> Prototypes</a></li><li class="chapter-item "><a href="../editing_workflows/simulation.html"><strong aria-hidden="true">8.7.</strong> Simulation</a></li><li class="chapter-item "><a href="../editing_workflows/visual-scripting.html"><strong aria-hidden="true">8.8.</strong> Visual Scripting: Entity Graphs</a></li><li class="chapter-item "><a href="../editing_workflows/physics.html"><strong aria-hidden="true">8.9.</strong> Physics</a></li><li class="chapter-item "><a href="../editing_workflows/animation/index.html"><strong aria-hidden="true">8.10.</strong> Animation</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../editing_workflows/animation/animation-state-machine.html"><strong aria-hidden="true">8.10.1.</strong> Animation State Machines</a></li><li class="chapter-item "><a href="../editing_workflows/animation/animation-compression.html"><strong aria-hidden="true">8.10.2.</strong> Animation Compression</a></li></ol></li><li class="chapter-item "><a href="../editing_workflows/sound.html"><strong aria-hidden="true">8.11.</strong> Sound</a></li><li class="chapter-item "><a href="../editing_workflows/publish.html"><strong aria-hidden="true">8.12.</strong> Publish</a></li><li class="chapter-item "><a href="../editing_workflows/sculpting.html"><strong aria-hidden="true">8.13.</strong> Sculpt Tool / White boxing</a></li></ol></li><li class="chapter-item "><a href="../the_truth/index.html"><strong aria-hidden="true">9.</strong> The Truth</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../the_truth/access_values.html"><strong aria-hidden="true">9.1.</strong> Access values</a></li><li class="chapter-item "><a href="../the_truth/create_an_object.html"><strong aria-hidden="true">9.2.</strong> Create an object</a></li><li class="chapter-item "><a href="../the_truth/modify_an_object.html"><strong aria-hidden="true">9.3.</strong> Modify an object</a></li><li class="chapter-item "><a href="../the_truth/common_types.html"><strong aria-hidden="true">9.4.</strong> Common Types</a></li><li class="chapter-item "><a href="../the_truth/aspects.html"><strong aria-hidden="true">9.5.</strong> Aspects</a></li><li class="chapter-item "><a href="../the_truth/custom_truth_type.html"><strong aria-hidden="true">9.6.</strong> Create a Truth Type</a></li></ol></li><li class="chapter-item "><a href="../creation_graphs/concept.html"><strong aria-hidden="true">10.</strong> Creation Graphs</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../creation_graphs/intro_unity.html"><strong aria-hidden="true">10.1.</strong> Creation Graphs for Untiy Dev's</a></li><li class="chapter-item "><a href="../creation_graphs/intro_unreal.html"><strong aria-hidden="true">10.2.</strong> Creation Graphs for Unreal 4 Dev's</a></li><li class="chapter-item "><a href="../creation_graphs/node_types.html"><strong aria-hidden="true">10.3.</strong> Node Types</a></li><li class="chapter-item "><a href="../creation_graphs/shader_system.html"><strong aria-hidden="true">10.4.</strong> Shader System Interaction</a></li></ol></li><li class="chapter-item "><a href="../graphics/index.html"><strong aria-hidden="true">11.</strong> Graphics</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../graphics/default_render_pipeline.html"><strong aria-hidden="true">11.1.</strong> Default Render Pipeline</a></li><li class="chapter-item "><a href="../graphics/mesh_materials.html"><strong aria-hidden="true">11.2.</strong> Meshes / Materials</a></li><li class="chapter-item "><a href="../graphics/shaders.html"><strong aria-hidden="true">11.3.</strong> Shaders</a></li><li class="chapter-item "><a href="../graphics/the_machinery_shading_language.html"><strong aria-hidden="true">11.4.</strong> The Machinery Shading Language</a></li><li class="chapter-item "><a href="../graphics/tmsl_vs.html"><strong aria-hidden="true">11.5.</strong> .tmsl Visual Studio Extension</a></li></ol></li><li class="chapter-item expanded "><a href="../extending_the_machinery/index.html"><strong aria-hidden="true">12.</strong> Extending The Machinery</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../extending_the_machinery/the_plugin_system.html"><strong aria-hidden="true">12.1.</strong> The Plugin System</a></li><li class="chapter-item "><a href="../extending_the_machinery/hot-reloading.html"><strong aria-hidden="true">12.2.</strong> Hot-reloading</a></li><li class="chapter-item expanded "><a href="../extending_the_machinery/write-a-plugin.html" class="active"><strong aria-hidden="true">12.3.</strong> Write a plugin</a></li><li class="chapter-item "><a href="../extending_the_machinery/write-a-tab.html"><strong aria-hidden="true">12.4.</strong> Write a tab</a></li><li class="chapter-item "><a href="../extending_the_machinery/plugin-assets.html"><strong aria-hidden="true">12.5.</strong> Plugin assets</a></li><li class="chapter-item "><a href="../extending_the_machinery/application_hooks.html"><strong aria-hidden="true">12.6.</strong> Application Hooks</a></li></ol></li><li class="chapter-item "><a href="../gameplay_coding/index.html"><strong aria-hidden="true">13.</strong> Gameplay coding</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../gameplay_coding/simulation_entry.html"><strong aria-hidden="true">13.1.</strong> Simulation Entry in C</a></li><li class="chapter-item "><a href="../gameplay_coding/visual_scripting/index.html"><strong aria-hidden="true">13.2.</strong> Visual Scripting</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../gameplay_coding/visual_scripting/subgraphs.html"><strong aria-hidden="true">13.2.1.</strong> Subgraphs</a></li><li class="chapter-item "><a href="../gameplay_coding/visual_scripting/debugger.html"><strong aria-hidden="true">13.2.2.</strong> Debugger</a></li></ol></li><li class="chapter-item "><a href="../gameplay_coding/ecs/index.html"><strong aria-hidden="true">13.3.</strong> Entity Component System</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../gameplay_coding/ecs/what_are_components.html"><strong aria-hidden="true">13.3.1.</strong> What are components</a></li><li class="chapter-item "><a href="../gameplay_coding/ecs/how_entites_can_interact.html"><strong aria-hidden="true">13.3.2.</strong> How can Entities Interact?</a></li><li class="chapter-item "><a href="../gameplay_coding/ecs/how_to_design_system_or_engine.html"><strong aria-hidden="true">13.3.3.</strong> How to design a System or an Engine?</a></li><li class="chapter-item "><a href="../gameplay_coding/ecs/how_to_define_a_engine_system.html"><strong aria-hidden="true">13.3.4.</strong> How to define a System or an Engine?</a></li><li class="chapter-item "><a href="../gameplay_coding/ecs/how_to_register_a_system_or_engine.html"><strong aria-hidden="true">13.3.5.</strong> How to register a System or an Engine?</a></li><li class="chapter-item "><a href="../gameplay_coding/ecs/write_a_custom_component.html"><strong aria-hidden="true">13.3.6.</strong> Write a custom component</a></li><li class="chapter-item "><a href="../gameplay_coding/ecs/tagging_entities.html"><strong aria-hidden="true">13.3.7.</strong> Tagging Entities</a></li><li class="chapter-item "><a href="../gameplay_coding/ecs/filtering_entities.html"><strong aria-hidden="true">13.3.8.</strong> Filtering Entities</a></li><li class="chapter-item "><a href="../gameplay_coding/ecs/simulation_lifecycle.html"><strong aria-hidden="true">13.3.9.</strong> Simulation Lifecycle</a></li></ol></li><li class="chapter-item "><a href="../gameplay_coding/gameplay_entry_comparison.html"><strong aria-hidden="true">13.4.</strong> Gameplay Entry Point Comparison</a></li></ol></li><li class="chapter-item "><a href="../collaboration.html"><strong aria-hidden="true">14.</strong> Collaboration</a></li><li class="chapter-item "><a href="../qa_pipeline/index.html"><strong aria-hidden="true">15.</strong> QA Pipeline</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../qa_pipeline/statistics.html"><strong aria-hidden="true">15.1.</strong> Statistics Tab</a></li><li class="chapter-item "><a href="../qa_pipeline/profiler.html"><strong aria-hidden="true">15.2.</strong> Profiler Tab</a></li><li class="chapter-item "><a href="../qa_pipeline/memory.html"><strong aria-hidden="true">15.3.</strong> Memory Usage Tab</a></li><li class="chapter-item "><a href="../qa_pipeline/logging.html"><strong aria-hidden="true">15.4.</strong> Logging</a></li><li class="chapter-item "><a href="../qa_pipeline/how_to_write_unit_tests.html"><strong aria-hidden="true">15.5.</strong> Write your own unit tests</a></li><li class="chapter-item "><a href="../qa_pipeline/how_to_write_integration_tests.html"><strong aria-hidden="true">15.6.</strong> Write your own integration tests</a></li></ol></li><li class="chapter-item "><a href="../helper_tools/index.html"><strong aria-hidden="true">16.</strong> Helper Tools</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../helper_tools/tmbuild.html"><strong aria-hidden="true">16.1.</strong> How to use tmbuild</a></li><li class="chapter-item "><a href="../helper_tools/hash.html"><strong aria-hidden="true">16.2.</strong> How to use hash</a></li><li class="chapter-item "><a href="../helper_tools/tmbuild_package_reference.html"><strong aria-hidden="true">16.3.</strong> tmbuild package reference</a></li></ol></li><li class="chapter-item "><a href="../writing_an_executable.html"><strong aria-hidden="true">17.</strong> Writing an executable</a></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">The Machinery Book</h1>

                    <div class="right-buttons">
                                                <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        <a href="https://github.com/OurMachinery/themachinery-books" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                                                
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h2 id="write-a-plugin"><a class="header" href="#write-a-plugin">Write a plugin</a></h2>
<p>This walkthrough show you how to extend the engine with a custom plugin.</p>
<p>You will learn about:</p>
<ul>
<li>What is needed to write a plugin</li>
<li>How to write a plugin</li>
</ul>
<p>This walk through expects you to have the basic understanding about the plugin system. Otherwise you can read more <a href="https://ourmachinery.github.io/themachinery-books/the_machinery_book/extending_the_machinery/the_plugin_system.html">here</a>.</p>
<p><strong>Table of Content</strong></p>
<ul>
<li><a href="#where-does-the-engine-search-for-plugins">Where does the engine search for plugins</a></li>
<li><a href="#inspect-a-existing-example-to-get-inspiration">Inspect a existing example to get inspiration</a>
<ul>
<li><a href="#what-are-the-build-requirements">What are the build Requirements</a></li>
<li><a href="#build-the-sample-plugin">Build the sample plugin</a></li>
</ul>
</li>
<li><a href="#programming-in-c">Programming in C</a>
<ul>
<li><a href="#write-your-own-plugin">Write your own plugin</a></li>
<li><a href="#structure-of-a-plugin">Structure of a plugin</a>
<ul>
<li><a href="#where-does-my-gameplay-code-live">Where does my gameplay code live?</a></li>
<li><a href="#how-do-i-update-my-tool--tab-content">How do I update my tool / tab content?</a></li>
<li><a href="#plugin-callbacks-init-sutdown-tick">Plugin callbacks (Init, Sutdown, Tick)</a></li>
<li><a href="#how-do-i-deal-with-static-variables">How do I deal with static variables?</a></li>
</ul>
</li>
<li><a href="#write-your-own-api">Write your own API</a></li>
</ul>
</li>
</ul>
<h2 id="where-does-the-engine-search-for-plugins"><a class="header" href="#where-does-the-engine-search-for-plugins">Where does the engine search for plugins</a></h2>
<p>The Machinery is built around a plugin model. All features, even the built-in ones, are provided
through plugins. You can extend The Machinery by writing your own plugins. When The Machinery
launches, it loads all the plugins named <code>tm_*.dll</code> in its <code>plugins/</code> folder. If you write your own
plugins, name them so that they start with <code>tm_</code> and put them in this folder, they will be loaded
together with the built-in plugins.</p>
<blockquote>
<p><strong>Note:</strong> When you create a new plugin via the Engine, the <code>premake</code> file will <strong>not</strong> copy the plugin into your global plugin folder. The reason behind this is that we do not know if you want to create a plugin asset. <em>This workflow is currently under review.</em></p>
<p><strong>Important:</strong> The plugins created via the Engine expect a binary build version if you are using the source access version you might have to modify the <code>premake</code> file to make it point to the correct version. This workflow is currently under review.</p>
</blockquote>
<h2 id="inspect-a-existing-example-to-get-inspiration"><a class="header" href="#inspect-a-existing-example-to-get-inspiration">Inspect a existing example to get inspiration</a></h2>
<p>The easiest way to build a plugin is to start with an existing example. There are three places where
you can find plugin samples:</p>
<ol>
<li>
<p>The <code>samples</code> folder in the SDK has a number of plugin samples.</p>
</li>
<li>
<p>The <em>All Sample Projects</em> package in the <em>Download</em> tab has a <code>plugins</code> folder with some small
samples.</p>
</li>
<li>
<p>You can create a new plugin with the menu command <strong>File &gt; New Plugin</strong>. This will create a
new <code>.c</code> file for the plugin together with some helper files for compiling it. (<a href="#write-your-own-plugin">Follow this guide</a>)</p>
</li>
</ol>
<p>The distribution already comes with pre-built .dlls for the sample plugins, such as
<code>bin/plugins/tm_pong_tab.dll</code>. You can see this plugin in action by selecting <strong>Tab &gt; Pong</strong> in the
editor to open up its tab:</p>
<p><img src="https://www.dropbox.com/s/hats2jgr3wroahz/pong-tab.png?dl=1" alt="Pong tab." /></p>
<h3 id="what-are-the-build-requirements"><a class="header" href="#what-are-the-build-requirements">What are the build Requirements</a></h3>
<p>To build plugins you need three things:</p>
<ol>
<li>You need to have Visual Studio 2019 installed including the MS C++ Build Tools on your computer.
Note that the Community Edition works fine. (Or clang and the build essentials on Linux)</li>
<li>You need to set the <code>TM_SDK_DIR</code> environment variable to the path of the SDK package that you
installed on your computer. When you compile a plugin, it looks for The Machinery headers in the
<code>%TM_SDK_DIR%/headers</code> folder. </li>
<li>You need the <code>tmbuild.exe</code> from the SDK package. <code>tmbuild.exe</code> does all the steps needed to
compile the plugin. Put it in your <code>PATH</code> or copy it to your plugin folder so that you can run it
easily from the command line.</li>
</ol>
<h3 id="build-the-sample-plugin"><a class="header" href="#build-the-sample-plugin">Build the sample plugin</a></h3>
<p>To compile a plugin, simply open a command prompt in the plugin folder and run the <code>tmbuild.exe</code>
executable:</p>
<pre><code class="language-cmdinput">sample-projects/plugins/custom_tab&gt; %TM_SDK_DIR%/bin/tmbuild.exe
​~~~ cmd output
Installing 7za.exe...
Installing premake-5.0.0-alpha14-windows...
Building configurations...
Running action 'vs2019'...
Generated custom_tab.sln...
Generated build/custom_tab/custom_tab.vcxproj...
Done (133ms).
Microsoft (R) Build Engine version 16.4.0+e901037fe for .NET Framework
Copyright (C) Microsoft Corporation. All rights reserved.

  custom_tab.c
  custom_tab.vcxproj -&gt; C:\work\themachinery\build\bin\plugins\tm_custom_tab.dll

-----------------------------
tmbuild completed in: 23.471 s
</code></pre>
<p><code>tmbuild.exe</code> will perform the following steps to build your executable:</p>
<ol>
<li>Create a <code>libs</code> folder and download <code>premake5</code> into it. (You can set the <code>TM_LIB_DIR</code> environment
variable to use a shared <code>libs</code> directory for all your projects.)</li>
<li>Run <code>premake5</code> to create a Visual Studio project from the <code>premake5.lua</code> script.</li>
<li>Build the Visual Studio project to build the plugin.</li>
</ol>
<blockquote>
<p><strong>Note:</strong> You can learn more about <a href="https://ourmachinery.github.io/themachinery-books/the_machinery_book/helper_tools/tmbuild.html">tmbuild</a> in its own section.</p>
</blockquote>
<h2 id="programming-in-c"><a class="header" href="#programming-in-c">Programming in C</a></h2>
<p><em>The Machinery</em> uses C99 as its interface language. I.e., all the header files that you use to
communicate with <em>The Machinery</em> are C99 header files, and when you write a plugin you should expose
C99 headers for your APIs. The <em>implementation</em> of a plugin can be written in whichever language you
like, as long as it exposes and communicates through a C99 header. In particular, you can write the
implementation in C++ if you want to. (At Our Machinery, we write the implementations in C99.)</p>
<h3 id="write-your-own-plugin"><a class="header" href="#write-your-own-plugin">Write your own plugin</a></h3>
<p>To write a plugin you need to implement a <code>tm_load_plugin()</code> function that is called whenever the
plugin DLL is loaded/unloaded. In this function, you can interact with various engine interfaces. For
example, you can implement <a href="https://ourmachinery.com/apidoc/foundation/unit_test.h.html#structtm_unit_test_i">tm_unit_test_i</a> to implement unit tests that get run
together with the engine unit tests, you can implement <a href="https://ourmachinery.com/apidoc/foundation/the_truth.h.html#tm_the_truth_create_types_i">tm_the_truth_create_types_i</a> to
extend our data model, The Truth, with your own data types or implement
<a href="https://ourmachinery.com/apidoc/plugins/entity/entity.h.html#tm_entity_create_component_i">tm_entity_create_component_i</a> to extend our entity model with your own component
types.</p>
<p>The following guides might help you:</p>
<ul>
<li><a href="https://ourmachinery.github.io/themachinery-books/the_machinery_book//gameplay_coding/ecs/write_a_custom_component.html">How to add a new component type</a></li>
<li><a href="https://ourmachinery.github.io/themachinery-books/the_machinery_book//the_truth/custom_truth_type.html">How to create a new Truth Type</a></li>
<li><a href="https://ourmachinery.github.io/themachinery-books/tutorials/">How to write a tab</a></li>
<li><a href="https://ourmachinery.github.io/themachinery-books/the_machinery_book/qa_pipeline/how_to_write_unit_tests.html">How to write unit tests</a></li>
<li><a href="https://ourmachinery.github.io/themachinery-books/the_machinery_book/qa_pipeline/how_to_write_integration_tests.html">How to write integration tests</a></li>
</ul>
<p>The Engine provides a easy way to create plugins for you via the <strong>File -&gt; New Plugins</strong> menu. There you can choose default plugin templates. They come with default files:</p>
<p><img src="https://www.dropbox.com/s/jhrqv8t8bbhr20u/tm_tut_new_tab.png?dl=1" alt="custom tab folder view" /></p>
<p><em>The folder structure for a custom tab called <code>custom_tab</code>.</em></p>
<ul>
<li><code>premake5.lua</code> - Your build configuration, on Windows it will generate a <code>.sln</code> file for you.</li>
<li><code>libs.json</code> - Defines the binary dependencies of your projects. <code>tmbuild</code> will automatically download them for you.</li>
<li><code>*.c</code> - Your source file. It contains the sample template code to give you some guidance on what is needed.</li>
<li><code>build.bat</code> / <code>build.sh</code> - quick build files to make building simpler for you.</li>
</ul>
<blockquote>
<p><strong>Note:</strong> By default the plugin will not be copied into your Engine's <code>plugins</code> folder. You can modify the <code>premake</code> file or copy it manually in the folder. You can also make use of a Plugin Asset.</p>
</blockquote>
<h3 id="structure-of-a-plugin"><a class="header" href="#structure-of-a-plugin">Structure of a plugin</a></h3>
<p>Every plugin has <code>tm_load_plugin()</code> as its entry point, in there we register everything we need to register to the Engines Plugin System. It is important that you do not execute heavy code in this function or relay on other plugins, since they might not be loaded yet! This function is just there to perform load and register operations.</p>
<h4 id="where-does-my-gameplay-code-live"><a class="header" href="#where-does-my-gameplay-code-live">Where does my gameplay code live?</a></h4>
<p>Your gameplay lives within the <a href="https://ourmachinery.github.io/themachinery-books/the_machinery_book//gameplay_coding/ecs/index.html">Systems / Engines</a> of the ECS or in the <a href="https://ourmachinery.github.io/themachinery-books/the_machinery_book/gameplay_coding/simulation_entry.html">Simulation Entry</a> and they have their own entry points.</p>
<h4 id="how-do-i-update-my-tool--tab-content"><a class="header" href="#how-do-i-update-my-tool--tab-content">How do I update my tool / tab content?</a></h4>
<ul>
<li>The <a href="https://ourmachinery.com/apidoc/plugins/ui/docking.h.html#structtm_tab_vt">tm_tab_vt</a> defines three functions for your tab to be updated:
<ul>
<li><code>tm_tab_vt.ui()</code> - Callback for drawing the content of the tab into the specified rect.</li>
<li><code>tm_tab_vt.ui_serial()</code> - <em>Optional.</em> If implemented, called from the main UI job once all parallel UI rendering (fork/join) has finished. This can be used for parts of the UI that needs to run serially, for example because they call out to non-thread-safe function.</li>
<li><code>tm_tab_vt.hidden_update()</code> - <em>Optional</em>. If the tab wants to do some processing when it is <em>not</em> the selected tab in its tabwell, it can implement this callback. This will be called for all created tabs whose content is currently <em>not</em> visible.</li>
</ul>
</li>
</ul>
<p>For more information follow the <a href="https://ourmachinery.github.io/themachinery-books/tutorials/">&quot;Write a tab&quot;</a> walkthrough.</p>
<h4 id="plugin-callbacks-init-sutdown-tick"><a class="header" href="#plugin-callbacks-init-sutdown-tick">Plugin callbacks (Init, Sutdown, Tick)</a></h4>
<p>The plugin system provides also for plugin callbacks. <strong>It is recommended to rely on these calls as little as possible.</strong> You should not rely on those for your gameplay code!</p>
<ul>
<li><a href="https://ourmachinery.com/apidoc/foundation/plugin_callbacks.h.html#structtm_plugin_init_i">tm_plugin_init_i</a> - Is typically called as early as possible after all plugins have been loaded.</li>
</ul>
<blockquote>
<p><strong>Note:</strong> It is not called when a plugin is reloaded.</p>
</blockquote>
<ul>
<li><a href="https://ourmachinery.com/apidoc/foundation/plugin_callbacks.h.html#structtm_plugin_shutdown_i">tm_plugin_shutdown_i</a> - Is typically be called as early as possible during the application shutdown sequence</li>
</ul>
<blockquote>
<p><strong>Note:</strong> Is not called when a plugin is reloaded.</p>
</blockquote>
<ul>
<li><a href="https://ourmachinery.com/apidoc/foundation/plugin_callbacks.h.html#structtm_plugin_tick_i">tm_plugin_tick_i</a> - Is typically called as early as possible in the application main loop “tick”.</li>
</ul>
<p>They are stored in the <code>foundation/plugin_callbacks.h</code>.</p>
<h4 id="how-do-i-deal-with-static-variables"><a class="header" href="#how-do-i-deal-with-static-variables">How do I deal with static variables?</a></h4>
<p>The use of static variables in DLLs can be problematic, because when the DLL is reloaded, the new instance of the DLL will get a new freshly initialized static variable, losing whatever content the variable had before reload. The <a href="https://ourmachinery.com/apidoc/foundation/api_registry.h.html#structtm_api_registry_api">tm_api_registry_api</a> provides a way to solve this issue:  <code>tm_api_registry_api.static_variable()</code></p>
<p>By using this function instead of defining it globally, the variable data is saved in permanent memory.</p>
<pre><code class="language-c">#include &lt;foundation/api_registry.h&gt;

uint64_t *count_ptr;

TM_DLL_EXPORT void tm_load_plugin(struct tm_api_registry_api *reg, bool load)
{
    count_ptr = (uint64_t *)reg-&gt;static_variable(TM_STATIC_HASH(&quot;my_count&quot;, 0xa287d4b3ec9c2109ULL), sizeof(uint64_t), __FILE__, __LINE__);
}

void f()
{
    ++*count_ptr;
}
</code></pre>
<h3 id="write-your-own-api"><a class="header" href="#write-your-own-api">Write your own API</a></h3>
<p>You can also create your own APIs that other plugins can query for. If you create your own APIs, you
want to define them in your header file, so that other plugins can <code>#include</code> it and know how to
call your APIs. </p>
<blockquote>
<p>Note that if you are not defining your own APIs, but just implementing some of the engine's ones, your plugin typically doesn't need a header file.</p>
</blockquote>
<p><strong>my_plugin.h:</strong></p>
<pre><code class="language-c">#include &quot;foundation/api_types.h&quot;

struct my_api
{
    void (*foo)(void);
};

#define my_api_version TM_VERSION(1, 0, 0)
</code></pre>
<p><strong>my_plugin.c:</strong></p>
<pre><code class="language-c">static struct tm_api_registry_api *tm_global_api_registry;
static struct tm_error_api *tm_error_api;
static struct tm_logger_api *tm_logger_api;

#include &quot;my_api.h&quot;

#include &quot;foundation/api_registry.h&quot;
#include &quot;foundation/error.h&quot;
#include &quot;foundation/log.h&quot;
#include &quot;foundation/unit_test.h&quot;

static void foo(void)
{
    // ...
}

static struct my_api *my_api = &amp;(struct my_api){
    .foo = foo,
};

static void my_unit_test_function(tm_unit_test_runner_i *tr, struct tm_allocator_i *a)
{
    // ...
}

static struct tm_unit_test_i *my_unit_test = &amp;(struct tm_unit_test_i){
    .name = &quot;my_api&quot;,
    .test = my_unit_test_function,
};

TM_DLL_EXPORT void tm_load_plugin(struct tm_api_registry_api *reg, bool load)
{
    tm_global_api_registry = reg;

    tm_error_api = tm_get_api(reg, tm_error_api);
    tm_logger_api = tm_get_api(reg, tm_logger_api);

    tm_set_or_remove_api(reg, load, my_api, my_api);

    tm_add_or_remove_implementation(reg, load, tm_unit_test_i, my_unit_test);
}
</code></pre>
<p>When The Machinery loads a plugin DLL, it looks for the <code>tm_load_plugin()</code> function and calls it. If it can't find the function, it prints an error message. We store the API registry pointer in a static variable so that we can use it everywhere in our DLL.
We also <code>tm_get_api()</code> some of the API pointers that we will use frequently and store them in static variables so that we don’t have to use the registry to query for them every time we want to use them. Finally, we add our own API to the registry, so others can query for and use it.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                                                    <a rel="prev" href="../extending_the_machinery/hot-reloading.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        
                                                    <a rel="next" href="../extending_the_machinery/write-a-tab.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                                    <a rel="prev" href="../extending_the_machinery/hot-reloading.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                
                                    <a rel="next" href="../extending_the_machinery/write-a-tab.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        
    </body>
</html>
