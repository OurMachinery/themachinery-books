<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Write your own unit tests - The Machinery Book</title>
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="../favicon.svg">
                        <link rel="shortcut icon" href="../favicon.png">
                <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
                <link rel="stylesheet" href="../css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="../fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item "><a href="../index.html"><strong aria-hidden="true">1.</strong> Welcome</a></li><li class="chapter-item "><a href="../what_is_the_machinery.html"><strong aria-hidden="true">2.</strong> What is The Machinery</a></li><li class="chapter-item "><a href="../licenses.html"><strong aria-hidden="true">3.</strong> Licenses</a></li><li class="chapter-item "><a href="../glossary.html"><strong aria-hidden="true">4.</strong> Glossary</a></li><li class="chapter-item "><a href="../troubleshooting.html"><strong aria-hidden="true">5.</strong> Troubleshooting</a></li><li class="chapter-item "><a href="../getting_started/index.html"><strong aria-hidden="true">6.</strong> Getting Started</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../getting_started/what_is_in_the_package.html"><strong aria-hidden="true">6.1.</strong> What is in this package</a></li><li class="chapter-item "><a href="../getting_started/logging_in.html"><strong aria-hidden="true">6.2.</strong> Sign In</a></li><li class="chapter-item "><a href="../getting_started/project_setup.html"><strong aria-hidden="true">6.3.</strong> Project Setup</a></li><li class="chapter-item "><a href="../getting_started/new_project.html"><strong aria-hidden="true">6.4.</strong> New Project</a></li><li class="chapter-item "><a href="../getting_started/first_gameplay_project.html"><strong aria-hidden="true">6.5.</strong> First Gameplay Project</a></li><li class="chapter-item "><a href="../getting_started/sample-projects.html"><strong aria-hidden="true">6.6.</strong> Sample Projects</a></li><li class="chapter-item "><a href="../getting_started/migration_from_unity.html"><strong aria-hidden="true">6.7.</strong> The Machinery for Unity Dev's</a></li><li class="chapter-item "><a href="../getting_started/migration_from_unreal.html"><strong aria-hidden="true">6.8.</strong> The Machinery for Unreal 4 Dev's</a></li><li class="chapter-item "><a href="../getting_started/migration_from_godot.html"><strong aria-hidden="true">6.9.</strong> The Machinery for Godot Dev's</a></li><li class="chapter-item "><a href="../getting_started/introduction_to_c.html"><strong aria-hidden="true">6.10.</strong> Introduction to C</a></li></ol></li><li class="chapter-item "><a href="../the_editor/index.html"><strong aria-hidden="true">7.</strong> The Editor</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../the_editor/tabs.html"><strong aria-hidden="true">7.1.</strong> About Tabs</a></li><li class="chapter-item "><a href="../the_editor/entity_tree_tab.html"><strong aria-hidden="true">7.2.</strong> Entity Tree Tab</a></li><li class="chapter-item "><a href="../the_editor/scene_tab.html"><strong aria-hidden="true">7.3.</strong> Scene Tab</a></li><li class="chapter-item "><a href="../the_editor/properties_tab.html"><strong aria-hidden="true">7.4.</strong> Properties Tab</a></li><li class="chapter-item "><a href="../the_editor/asset_browser.html"><strong aria-hidden="true">7.5.</strong> Asset Browser</a></li><li class="chapter-item "><a href="../the_editor/simulate_tab.html"><strong aria-hidden="true">7.6.</strong> Simulate Tab</a></li><li class="chapter-item "><a href="../the_editor/preview_tab.html"><strong aria-hidden="true">7.7.</strong> Preview Tab</a></li><li class="chapter-item "><a href="../the_editor/customizations.html"><strong aria-hidden="true">7.8.</strong> Customizations</a></li></ol></li><li class="chapter-item "><a href="../editing_workflows/index.html"><strong aria-hidden="true">8.</strong> Editing Workflows</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../editing_workflows/entities.html"><strong aria-hidden="true">8.1.</strong> Entities</a></li><li class="chapter-item "><a href="../editing_workflows/import_assets.html"><strong aria-hidden="true">8.2.</strong> Import Assets</a></li><li class="chapter-item "><a href="../editing_workflows/import_projects.html"><strong aria-hidden="true">8.3.</strong> Import Projects</a></li><li class="chapter-item "><a href="../editing_workflows/asset_pipeline.html"><strong aria-hidden="true">8.4.</strong> Asset pipeline by Example</a></li><li class="chapter-item "><a href="../editing_workflows/shaders_materials.html"><strong aria-hidden="true">8.5.</strong> Meshes / Materials / Shaders</a></li><li class="chapter-item "><a href="../editing_workflows/prototypes.html"><strong aria-hidden="true">8.6.</strong> Prototypes</a></li><li class="chapter-item "><a href="../editing_workflows/simulation.html"><strong aria-hidden="true">8.7.</strong> Simulation</a></li><li class="chapter-item "><a href="../editing_workflows/visual-scripting.html"><strong aria-hidden="true">8.8.</strong> Visual Scripting: Entity Graphs</a></li><li class="chapter-item "><a href="../editing_workflows/physics.html"><strong aria-hidden="true">8.9.</strong> Physics</a></li><li class="chapter-item "><a href="../editing_workflows/animation/index.html"><strong aria-hidden="true">8.10.</strong> Animation</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../editing_workflows/animation/animation-state-machine.html"><strong aria-hidden="true">8.10.1.</strong> Animation State Machines</a></li><li class="chapter-item "><a href="../editing_workflows/animation/animation-compression.html"><strong aria-hidden="true">8.10.2.</strong> Animation Compression</a></li></ol></li><li class="chapter-item "><a href="../editing_workflows/sound.html"><strong aria-hidden="true">8.11.</strong> Sound</a></li><li class="chapter-item "><a href="../editing_workflows/publish.html"><strong aria-hidden="true">8.12.</strong> Publish</a></li><li class="chapter-item "><a href="../editing_workflows/sculpting.html"><strong aria-hidden="true">8.13.</strong> Sculpt Tool / White boxing</a></li></ol></li><li class="chapter-item "><a href="../the_truth/index.html"><strong aria-hidden="true">9.</strong> The Truth</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../the_truth/access_values.html"><strong aria-hidden="true">9.1.</strong> Access values</a></li><li class="chapter-item "><a href="../the_truth/create_an_object.html"><strong aria-hidden="true">9.2.</strong> Create an object</a></li><li class="chapter-item "><a href="../the_truth/modify_an_object.html"><strong aria-hidden="true">9.3.</strong> Modify an object</a></li><li class="chapter-item "><a href="../the_truth/common_types.html"><strong aria-hidden="true">9.4.</strong> Common Types</a></li><li class="chapter-item "><a href="../the_truth/aspects.html"><strong aria-hidden="true">9.5.</strong> Aspects</a></li><li class="chapter-item "><a href="../the_truth/custom_truth_type.html"><strong aria-hidden="true">9.6.</strong> Create a Truth Type</a></li></ol></li><li class="chapter-item "><a href="../creation_graphs/concept.html"><strong aria-hidden="true">10.</strong> Creation Graphs</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../creation_graphs/intro_unity.html"><strong aria-hidden="true">10.1.</strong> Creation Graphs for Untiy Dev's</a></li><li class="chapter-item "><a href="../creation_graphs/intro_unreal.html"><strong aria-hidden="true">10.2.</strong> Creation Graphs for Unreal 4 Dev's</a></li><li class="chapter-item "><a href="../creation_graphs/node_types.html"><strong aria-hidden="true">10.3.</strong> Node Types</a></li><li class="chapter-item "><a href="../creation_graphs/shader_system.html"><strong aria-hidden="true">10.4.</strong> Shader System Interaction</a></li></ol></li><li class="chapter-item "><a href="../graphics/index.html"><strong aria-hidden="true">11.</strong> Graphics</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../graphics/camera.html"><strong aria-hidden="true">11.1.</strong> Camera</a></li><li class="chapter-item "><a href="../graphics/physical_light_and_camera.html"><strong aria-hidden="true">11.2.</strong> Physically Based Light and Cameras</a></li><li class="chapter-item "><a href="../graphics/default_render_pipeline.html"><strong aria-hidden="true">11.3.</strong> Default Render Pipeline</a></li><li class="chapter-item "><a href="../graphics/mesh_materials.html"><strong aria-hidden="true">11.4.</strong> Meshes / Materials</a></li><li class="chapter-item "><a href="../graphics/shaders.html"><strong aria-hidden="true">11.5.</strong> Shaders</a></li><li class="chapter-item "><a href="../graphics/the_machinery_shading_language.html"><strong aria-hidden="true">11.6.</strong> The Machinery Shading Language</a></li><li class="chapter-item "><a href="../graphics/tmsl_vs.html"><strong aria-hidden="true">11.7.</strong> .tmsl Visual Studio Extension</a></li></ol></li><li class="chapter-item "><a href="../extending_the_machinery/index.html"><strong aria-hidden="true">12.</strong> Extending The Machinery</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../extending_the_machinery/the_plugin_system.html"><strong aria-hidden="true">12.1.</strong> The Plugin System</a></li><li class="chapter-item "><a href="../extending_the_machinery/hot-reloading.html"><strong aria-hidden="true">12.2.</strong> Hot-reloading</a></li><li class="chapter-item "><a href="../extending_the_machinery/write-a-plugin.html"><strong aria-hidden="true">12.3.</strong> Write a plugin</a></li><li class="chapter-item "><a href="../extending_the_machinery/write-a-tab.html"><strong aria-hidden="true">12.4.</strong> Write a tab</a></li><li class="chapter-item "><a href="../extending_the_machinery/plugin-assets.html"><strong aria-hidden="true">12.5.</strong> Plugin assets</a></li><li class="chapter-item "><a href="../extending_the_machinery/application_hooks.html"><strong aria-hidden="true">12.6.</strong> Application Hooks</a></li></ol></li><li class="chapter-item "><a href="../gameplay_coding/index.html"><strong aria-hidden="true">13.</strong> Gameplay coding</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../gameplay_coding/simulation_entry.html"><strong aria-hidden="true">13.1.</strong> Simulation Entry in C</a></li><li class="chapter-item "><a href="../gameplay_coding/visual_scripting/index.html"><strong aria-hidden="true">13.2.</strong> Visual Scripting</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../gameplay_coding/visual_scripting/subgraphs.html"><strong aria-hidden="true">13.2.1.</strong> Subgraphs</a></li><li class="chapter-item "><a href="../gameplay_coding/visual_scripting/debugger.html"><strong aria-hidden="true">13.2.2.</strong> Debugger</a></li></ol></li><li class="chapter-item "><a href="../gameplay_coding/ecs/index.html"><strong aria-hidden="true">13.3.</strong> Entity Component System</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../gameplay_coding/ecs/what_are_components.html"><strong aria-hidden="true">13.3.1.</strong> What are components</a></li><li class="chapter-item "><a href="../gameplay_coding/ecs/how_entites_can_interact.html"><strong aria-hidden="true">13.3.2.</strong> How can Entities Interact?</a></li><li class="chapter-item "><a href="../gameplay_coding/ecs/how_to_design_system_or_engine.html"><strong aria-hidden="true">13.3.3.</strong> How to design a System or an Engine?</a></li><li class="chapter-item "><a href="../gameplay_coding/ecs/how_to_define_a_engine_system.html"><strong aria-hidden="true">13.3.4.</strong> How to define a System or an Engine?</a></li><li class="chapter-item "><a href="../gameplay_coding/ecs/how_to_register_a_system_or_engine.html"><strong aria-hidden="true">13.3.5.</strong> How to register a System or an Engine?</a></li><li class="chapter-item "><a href="../gameplay_coding/ecs/write_a_custom_component.html"><strong aria-hidden="true">13.3.6.</strong> Write a custom component</a></li><li class="chapter-item "><a href="../gameplay_coding/ecs/tagging_entities.html"><strong aria-hidden="true">13.3.7.</strong> Tagging Entities</a></li><li class="chapter-item "><a href="../gameplay_coding/ecs/filtering_entities.html"><strong aria-hidden="true">13.3.8.</strong> Filtering Entities</a></li><li class="chapter-item "><a href="../gameplay_coding/ecs/simulation_lifecycle.html"><strong aria-hidden="true">13.3.9.</strong> Simulation Lifecycle</a></li></ol></li><li class="chapter-item "><a href="../gameplay_coding/gameplay_entry_comparison.html"><strong aria-hidden="true">13.4.</strong> Gameplay Entry Point Comparison</a></li></ol></li><li class="chapter-item "><a href="../collaboration.html"><strong aria-hidden="true">14.</strong> Collaboration</a></li><li class="chapter-item expanded "><a href="../qa_pipeline/index.html"><strong aria-hidden="true">15.</strong> QA Pipeline</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../qa_pipeline/statistics.html"><strong aria-hidden="true">15.1.</strong> Statistics Tab</a></li><li class="chapter-item "><a href="../qa_pipeline/profiler.html"><strong aria-hidden="true">15.2.</strong> Profiler Tab</a></li><li class="chapter-item "><a href="../qa_pipeline/memory.html"><strong aria-hidden="true">15.3.</strong> Memory Usage Tab</a></li><li class="chapter-item "><a href="../qa_pipeline/logging.html"><strong aria-hidden="true">15.4.</strong> Logging</a></li><li class="chapter-item expanded "><a href="../qa_pipeline/how_to_write_unit_tests.html" class="active"><strong aria-hidden="true">15.5.</strong> Write your own unit tests</a></li><li class="chapter-item "><a href="../qa_pipeline/how_to_write_integration_tests.html"><strong aria-hidden="true">15.6.</strong> Write your own integration tests</a></li></ol></li><li class="chapter-item "><a href="../helper_tools/index.html"><strong aria-hidden="true">16.</strong> Helper Tools</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../helper_tools/tmbuild.html"><strong aria-hidden="true">16.1.</strong> How to use tmbuild</a></li><li class="chapter-item "><a href="../helper_tools/hash.html"><strong aria-hidden="true">16.2.</strong> How to use hash</a></li><li class="chapter-item "><a href="../helper_tools/tmbuild_package_reference.html"><strong aria-hidden="true">16.3.</strong> tmbuild package reference</a></li></ol></li><li class="chapter-item "><a href="../writing_an_executable.html"><strong aria-hidden="true">17.</strong> Writing an executable</a></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">The Machinery Book</h1>

                    <div class="right-buttons">
                                                <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        <a href="https://github.com/OurMachinery/themachinery-books" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                                                
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <p>This walkthrough introduces you to unit-tests.exe and shows you how to use it with The Machinery. You will learn about:</p>
<ul>
<li>How to run tests</li>
<li>How to constantly monitor your changes</li>
<li>How to write tests in your plugin</li>
</ul>
<p>This walkthrough expects basic knowledge on how to create a plugin and how a plugin is structured. If you are missing this knowledge, then you can find out more <a href="https://ourmachinery.github.io/themachinery-books/the_machinery_book/extending_the_machinery/the_plugin_system.html">here</a>.</p>
<blockquote>
<p><strong>Note:</strong> At this point, the testing framework is in the beginning stage. We are extending its capabilities overtime to meet the needs of modern game development QA pipelines.</p>
</blockquote>
<h2 id="about-unit-tests"><a class="header" href="#about-unit-tests"><strong>About unit-tests</strong></a></h2>
<p>You can find the executable alongside <code>tmbuild</code> or the machinery executable in the <code>bin/ folder.</code> If you want to make the unit-tests executable globally accessible, you need to add it to your path environment variable. As you may have noticed, ensuring the quality of your build, <code>tmbuild</code> will run all unit tests of all plugins at the end of its build process. When you add a unit test to your plugin, it is guaranteed that its unit tests run every time you build. This is, of course, only guaranteed if the plugin system can find the plugin and its test.</p>
<blockquote>
<p><strong>Note:</strong> unit-tests will assume that the plugins live in a folder relative to the executable in the standardized folder plugins. If you need to load a plugin that is not in this folder, you need to provide a valid path via <code>-p/--plugin</code> so that unit-tests can find and run your tests.</p>
</blockquote>
<h2 id="how-to-run-tests"><a class="header" href="#how-to-run-tests"><strong>How to run tests</strong></a></h2>
<p>To run all unit tests, execute unit-test, and it will run all tests besides the slow execution path tests. To run all unit tests, including the <em>&quot;slow&quot;</em> ones, you run <code>unit-tests.exe -s/--slow-paths</code></p>
<blockquote>
<p><strong>Note:</strong> You may have noticed that if you run <code>tmbuild</code> regularly, you are lucky and win in the &quot;lottery&quot; from time to time. This means <code>tmbuild</code> will run all unit tests including the slow ones via <code>unit-tests</code>.</p>
</blockquote>
<h2 id="how-to-constantly-monitor-your-changes"><a class="header" href="#how-to-constantly-monitor-your-changes"><strong>How to constantly monitor your changes</strong></a></h2>
<p>Like the editor, <code>unit-tests</code> supports <a href="https://ourmachinery.com/post/dll-hot-reloading-in-theory-and-practice/">hot reloading</a>. In a nutshell, whenever plugins are rebuilt <code>unit-tests</code> can detect this and rerun the tests. To run in hot-reload mode start<code>unit-tests</code> with the <code>-r/--hot-reload</code> argument.</p>
<p><em>When could this be useful?</em>
It can be helpful on CI Server where build and test servers are different. The build server's final build step uploads the generated <code>dlls</code> to the test server if everything works fine. The test server is monitoring the filesystem, and whenever the dlls change, <code>unit-tests</code> would rerun all tests, also the slow ones, to ensure that all works. It could save time on the build server so the build times are faster and the developer knows quicker if the build fails. Also, the build server does not need a graphics card to run eventual graphic pipeline-related tests. The test server, on the other hand, could run such tests.</p>
<h2 id="how-to-write-your-tests"><a class="header" href="#how-to-write-your-tests"><strong>How to write your tests</strong></a></h2>
<p>All that is needed is to write tests is to register them via the <a href="https://ourmachinery.com/apidoc/foundation/unit_test.h.html#tm_unit_test_interface_name">tm_unit_test_i</a>. You can find the interface in the <a href="https://ourmachinery.com/apidoc/foundation/unit_test.h.html">unit_tests.h</a>. <a href="https://ourmachinery.com/apidoc/foundation/unit_test.h.html#tm_unit_test_i">tm_unit_test_i</a> expects a pointer of the type <a href="https://ourmachinery.com/apidoc/foundation/unit_test.h.html#structtm_unit_test_i">tm_unit_test_i</a>. This interface expects a name and a function pointer to the test entry function.</p>
<pre><code class="language-c">// Interface for running unit tests. To find all unit test, query the API registry for
// `TM_UNIT_TEST_INTERFACE_NAME` implementations.
typedef struct tm_unit_test_i
{
    // Name of this unit test.
    const char *name;

    // Runs unit tests, using the specified test runner. The supplied allocator can be used for
    // any allocations that the unit test needs to make.
    void (*test)(tm_unit_test_runner_i *tr, struct tm_allocator_i *a);
} tm_unit_test_i;
</code></pre>
<p>At this point, we have not tackled the following possible questions:</p>
<ul>
<li>Where and how do we register the interface?</li>
<li>What could this interface look like?</li>
<li>What does the test itself look like?</li>
</ul>
<p><strong>Let us walk through those questions:</strong></p>
<p><em>Where and how do we register the interface?</em>
We need to register our tests in the same function as everything else that needs to be executed when a plugin loads: in our <code>tm_load_plugin</code>. It may look like this:</p>
<pre><code class="language-c">#include &lt;foundation/unit_test.h&gt;
//...
// my amazing plugin
TM_DLL_EXPORT void tm_load_plugin(struct tm_api_registry_api *reg, bool load)
{
    tm_global_api_registry = reg;
    //...
    tm_add_or_remove_implementation(reg, load, tm_unit_test_i, my_unit_tests);
}
</code></pre>
<p>Here we register our test interface to the <a href="https://ourmachinery.com/apidoc/foundation/unit_test.h.html#structtm_unit_test_i">tm_unit_test_i</a>.</p>
<p><em>What could this interface look like?</em>
After we have done this, all we need to do is declare our <code>my_unit_tests</code>. It is as easy as it gets:</p>
<pre><code class="language-c">#include &lt;foundation/unit_test.h&gt;
//...
tm_unit_test_i *entity_unit_test = &amp;(tm_unit_test_i){
    .name = &quot;my_unit_tests&quot;,
    .test = test_function,
};
</code></pre>
<p><em>What does the test itself look like?</em>
All that's left is to write the test. Let us write this test. In its core all we need to do is write a function of the signature: <code>(tm_unit_test_runner_i *tr, struct tm_allocator_i *a)</code>. In its body, we can define our tests.</p>
<pre><code class="language-c">static void test_function(tm_unit_test_runner_i *test_runner, tm_allocator_i *allocator)
{
    //.. code
}
</code></pre>
<p>The test runner variable test_runner is needed to communicate back to the test suite about failures etc. The following <a href="https://ourmachinery.com/apidoc/foundation/unit_test.h.html#tm_unit_test()">macros</a> will help you write tests. They are the heart of the actual tests.</p>
<table><thead><tr><th><strong>Macro</strong></th><th><strong>Arguments</strong></th><th><strong>Description</strong></th></tr></thead><tbody>
<tr><td>TM_UNIT_TEST</td><td>(test_runner, assertion)</td><td>Unit test macro. Tests the <code>assertion</code> using the test runner <code>test_runner</code>.</td></tr>
<tr><td>TM_UNIT_TESTF</td><td>(test_runner, assertion, format, ...)</td><td>As <code>TM_UNIT_TEST()</code> but records a formatted string in case of error.</td></tr>
<tr><td>TM_EXPECT_ERROR</td><td>(test_runner, error)</td><td>Expect the error message <code>error</code>. If the error message doesn't appear before the next call to <code>record()</code>, or if another error message appears before it, this will be considered a unit test failure.<br><br>Note that for <a href="https://ourmachinery.com/apidoc/foundation/unit_test.h.html#tm_expect_error()">TM_EXPECT_ERROR</a> to work properly, you must redirect error messages to go through the test runner, so that it can check that the error message matches what's expected.</td></tr>
</tbody></table>
<p>It's time for some tests. Let us write some tests for <a href="https://ourmachinery.com/apidoc/foundation/carray.inl.html#carray.inl">carrays</a></p>
<pre><code class="language-c">#include &lt;foundation/unit_test.h&gt;
#include &lt;foundation/carray.inl&gt;
//.. other code
static void test_function(tm_unit_test_runner_i *test_runner, tm_allocator_i *allocator)
{
    /*carray*/ int32_t *a = 0;
    TM_UNIT_TEST(test_runner, tm_carray_size(a) == 0);
    TM_UNIT_TEST(test_runner, tm_carray_capacity(a) == 0);
    TM_UNIT_TEST(test_runner, a == 0);
    tm_carray_push(a, 1, &amp;allocator);

    TM_UNIT_TEST(test_runner, tm_carray_size(a) == 1);
    TM_UNIT_TEST(test_runner, tm_carray_capacity(a) == 16);
    TM_UNIT_TEST(test_runner, a);
    TM_UNIT_TEST(test_runner, a[0] == 1);

    tm_carray_header(a)-&gt;size--;

    TM_UNIT_TEST(test_runner, tm_carray_size(a) == 0);
    TM_UNIT_TEST(test_runner, tm_carray_capacity(a) == 16);

    tm_carray_grow(a, 20, &amp;allocator);
    tm_carray_header(a)-&gt;size = 20;

    TM_UNIT_TEST(test_runner, tm_carray_size(a) == 20);
    TM_UNIT_TEST(test_runner, tm_carray_capacity(a) == 32);
}
</code></pre>
<p>All that's left is to build via <code>tmbuild</code> our plugin and watch the console output if our tests fail. This is how you integrate your tests into the whole build pipeline. </p>
<h3 id="contributors"><a class="header" href="#contributors">Contributors</a></h3>
<p><a href="mailto:noreply@github.com"><img src="https://www.gravatar.com/avatar/9181eb84f9c35729a3bad740fb7f9d93?s=32" alt="GitHub" /> GitHub</a></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                                                    <a rel="prev" href="../qa_pipeline/logging.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        
                                                    <a rel="next" href="../qa_pipeline/how_to_write_integration_tests.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                                    <a rel="prev" href="../qa_pipeline/logging.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                
                                    <a rel="next" href="../qa_pipeline/how_to_write_integration_tests.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        
    </body>
</html>
